
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lesson 4-2 - Adding Custom Functions To Emacs &#8212; Learn Elisp For Emacs (Draft In Progress)</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Best Practice 1 - Writing Better Elisp" href="../best-practice-1-writing-better-elisp/" />
    <link rel="prev" title="Lesson 4-1 - Writing Elisp In Emacs" href="../lesson-4-1-writing-elisp-in-emacs/" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../best-practice-1-writing-better-elisp/" title="Best Practice 1 - Writing Better Elisp"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../lesson-4-1-writing-elisp-in-emacs/" title="Lesson 4-1 - Writing Elisp In Emacs"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Learn Elisp For Emacs (Draft In Progress)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Lesson 4-2 - Adding Custom Functions To Emacs</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="lesson-4-2-adding-custom-functions-to-emacs">
<h1>Lesson 4-2 - Adding Custom Functions To Emacs<a class="headerlink" href="#lesson-4-2-adding-custom-functions-to-emacs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In order to run custom Elisp functions it is necessary to have them loaded into Emacs at run time.</p>
<p>On load time emacs executes a startup file. In Emacs-23 on Ubuntu 10.10 this is a file called <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> in your home directory.</p>
<p>This file may or may not exist. Emacs is quite happy for it not to exist. If you change any settings using the <em>Options</em> menu and then save them, the results will be written to the <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> file.</p>
</div>
<div class="section" id="a-simple-custom-function">
<h2>A Simple Custom Function<a class="headerlink" href="#a-simple-custom-function" title="Permalink to this headline">¶</a></h2>
<p>Open the <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> file (or create it if it doesn’t exist) and add the following function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defun</span> <span class="n">doodlebug</span> <span class="p">()</span>
 <span class="s2">&quot;Nonce function&quot;</span>
 <span class="p">(</span><span class="n">interactive</span><span class="p">)</span>
 <span class="p">(</span><span class="n">message</span> <span class="s2">&quot;Howdie-doodie fella&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The first time you do this, edit the <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> file and then open Emacs. If you edit it in Emacs you will need to quit and restart.</p>
<p>On starting Emacs all the code in <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> is reloaded and evaluated.</p>
<p>This function can be run simply. The command <em>[Alt][x]</em> is used to a run a function interactively. Typing <em>[Alt][x]</em> switches the focus in Emacs to the minibuffer - if you then type in a function name it will be executed. To run <code class="docutils literal notranslate"><span class="pre">doodlebug</span></code> simply type <em>[Alt][x]</em> and then <em>doodlebug</em>.</p>
<p>You should then see the output in the minibuffer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Howdie</span><span class="o">-</span><span class="n">doodie</span> <span class="n">fella</span>
</pre></div>
</div>
<p>Look carefully at the function definition. The third parameter of the list is the expression <code class="docutils literal notranslate"><span class="pre">(interactive)</span></code> - this is necessary if we are to invoke the function from either a key-binding or the minibuffer.</p>
</div>
<div class="section" id="a-custom-function-with-user-input">
<h2>A Custom Function With User Input<a class="headerlink" href="#a-custom-function-with-user-input" title="Permalink to this headline">¶</a></h2>
<p>Let’s edit the function to take some parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defun</span> <span class="n">doodlebug</span> <span class="p">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="p">)</span>
  <span class="s2">&quot;Nonce function&quot;</span>
  <span class="p">(</span><span class="n">interactive</span> <span class="s2">&quot;sAdjective: </span><span class="se">\n</span><span class="s2">sNoun: </span><span class="se">\n</span><span class="s2">sExclamation: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="n">message</span> <span class="s2">&quot;Its a </span><span class="si">%s</span><span class="s2"> thing, this </span><span class="si">%s</span><span class="s2">, so it is, </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="p">))</span>
</pre></div>
</div>
<p>You can’t reload the <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> file, but you can manually re-evaluated by using the command <em>Emacs-Lisp -&gt; Evaluate Buffer</em> in the <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> buffer.</p>
<p>When you run this version of the function with <em>[Alt][x]doodlebug</em> it will offer up three prompts, to wit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Adjective</span><span class="p">:</span>
<span class="n">Noun</span><span class="p">:</span>
<span class="n">Exclamation</span><span class="p">:</span>
</pre></div>
</div>
<p>As you type in a string at each prompt (ending with <em>[Return]</em>) each of the strings wll be bound to the variables <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code> in turn.</p>
<p>This behaviour in enabled by the new form of the <em>interactive</em> expression. The string which has been added to that expression consists of 6 separate components:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s</span>
<span class="n">Adjective</span><span class="p">:</span> \<span class="n">n</span>
<span class="n">s</span>
<span class="n">Noun</span><span class="p">:</span> \<span class="n">n</span>
<span class="n">s</span>
<span class="n">Exclamation</span><span class="p">:</span> \<span class="n">n</span>
</pre></div>
</div>
<p>The 2nd, 4th and 6th parts are the prompts which will be shown in the minibuffer. The three <code class="docutils literal notranslate"><span class="pre">s</span></code>’s are Interactive Codes  which refer to strings (ie key sequences terminated with <em>[Return]</em> which are entered at the prompt. There are a range of other Interative Codes, some of which are:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">a</span></code> - a function name</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">b</span></code> - the name of an existing buffer</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">B</span></code> - the name of a buffer which may or may not exist</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">c</span></code> - a character</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">C</span></code> - a command</div>
<div class="line">etc, etc</div>
</div>
<p>You can read the full list of <a class="reference external" href="http://www.gnu.org/software/emacs/elisp/html_node/Interactive-Codes.html#Interactive-Codes">Interactive Codes</a> in the reference manual</p>
</div>
<div class="section" id="binding-the-custom-function-to-a-key-sequence">
<h2>Binding The Custom Function To A Key Sequence<a class="headerlink" href="#binding-the-custom-function-to-a-key-sequence" title="Permalink to this headline">¶</a></h2>
<p>To bind the custom function to a key sequence add the following line to the <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">global</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">key</span> <span class="p">[</span><span class="n">f5</span><span class="p">]</span> <span class="s1">&#39;doodlebug)</span>
</pre></div>
</div>
<p>This expression will bind the function <code class="docutils literal notranslate"><span class="pre">doodlebug</span></code> to the <em>F5</em> function key. Once you have re-evaluated the <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> buffer you will be able to fire the function with the <em>F5</em> key.</p>
<p>We can identify which function is bound to which key with the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">lookup</span><span class="o">-</span><span class="n">key</span> <span class="p">(</span><span class="n">current</span><span class="o">-</span><span class="k">global</span><span class="o">-</span><span class="nb">map</span><span class="p">)</span> <span class="p">[</span><span class="n">f5</span><span class="p">])</span>
</pre></div>
</div>
<p>The rules for binding keys are a bit complex. We can use the operator <code class="docutils literal notranslate"><span class="pre">kbd</span></code> to generate the appropriate input to <code class="docutils literal notranslate"><span class="pre">global-set-key</span></code> and <code class="docutils literal notranslate"><span class="pre">lookup-key</span></code>, for instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">global</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">key</span> <span class="p">(</span><span class="n">kbd</span> <span class="s2">&quot;C-c a&quot;</span><span class="p">)</span> <span class="s1">&#39;doodlebug)</span>
<span class="p">(</span><span class="n">lookup</span><span class="o">-</span><span class="n">key</span> <span class="p">(</span><span class="n">current</span><span class="o">-</span><span class="k">global</span><span class="o">-</span><span class="nb">map</span><span class="p">)</span> <span class="p">(</span><span class="n">kbd</span> <span class="s2">&quot;C-c a&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The expression <code class="docutils literal notranslate"><span class="pre">(kbd</span> <span class="pre">&quot;C-c</span> <span class="pre">a&quot;)</span></code> generates the appropriate keymap for the key sequence <em>[C-c][a]</em>.</p>
</div>
<div class="section" id="what-you-have-learned">
<h2>What You Have Learned<a class="headerlink" href="#what-you-have-learned" title="Permalink to this headline">¶</a></h2>
<p>You have learned:</p>
<ul class="simple">
<li><p>a way to load a new function into emacs</p></li>
<li><p>how to make the function take interactive paramaters</p></li>
<li><p>how to invoke that command - via the command line and via a custom key</p></li>
</ul>
</div>
<div class="section" id="additional-reading">
<h2>Additional Reading<a class="headerlink" href="#additional-reading" title="Permalink to this headline">¶</a></h2>
<p>There is a good discussion of keybindings in your <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> file in the Emacs Lisp Introduction.</p>
<p>The whole process of binding keys to functions in emacs is quite complex and is covered in the <a class="reference external" href="http://www.gnu.org/s/emacs/manual/html_node/elisp/Keymaps.html#Keymaps">Keymaps</a> section of the manual</p>
</div>
<div class="section" id="extra-activities">
<h2>Extra Activities<a class="headerlink" href="#extra-activities" title="Permalink to this headline">¶</a></h2>
<p>What happens if you try and run a function which doesn’t include the expression <code class="docutils literal notranslate"><span class="pre">(interactive)</span></code>?</p>
<p>Experiment with other Interactive Codes in your functions.</p>
<p>Bind and unbind some keys to functions in your <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> file.</p>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Lesson 4-2 - Adding Custom Functions To Emacs</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#a-simple-custom-function">A Simple Custom Function</a></li>
<li><a class="reference internal" href="#a-custom-function-with-user-input">A Custom Function With User Input</a></li>
<li><a class="reference internal" href="#binding-the-custom-function-to-a-key-sequence">Binding The Custom Function To A Key Sequence</a></li>
<li><a class="reference internal" href="#what-you-have-learned">What You Have Learned</a></li>
<li><a class="reference internal" href="#additional-reading">Additional Reading</a></li>
<li><a class="reference internal" href="#extra-activities">Extra Activities</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="../lesson-4-1-writing-elisp-in-emacs/"
                          title="previous chapter">Lesson 4-1 - Writing Elisp In Emacs</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../best-practice-1-writing-better-elisp/"
                          title="next chapter">Best Practice 1 - Writing Better Elisp</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../best-practice-1-writing-better-elisp/" title="Best Practice 1 - Writing Better Elisp"
             >next</a> |</li>
        <li class="right" >
          <a href="../lesson-4-1-writing-elisp-in-emacs/" title="Lesson 4-1 - Writing Elisp In Emacs"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Learn Elisp For Emacs (Draft In Progress)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Lesson 4-2 - Adding Custom Functions To Emacs</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010, Gordon Guthrie.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>