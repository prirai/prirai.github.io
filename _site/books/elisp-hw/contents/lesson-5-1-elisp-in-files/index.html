
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lesson 5-1 - Elisp In Files &#8212; Learn Elisp For Emacs (Draft In Progress)</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Lesson 5-2 - Working With Buffers (1)" href="../lesson-5-2-working-with-buffers-1/" />
    <link rel="prev" title="Emacs And The .emacs File" href="../emacs-and-the-dot-emacs-file/" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../lesson-5-2-working-with-buffers-1/" title="Lesson 5-2 - Working With Buffers (1)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../emacs-and-the-dot-emacs-file/" title="Emacs And The .emacs File"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Learn Elisp For Emacs (Draft In Progress)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Lesson 5-1 - Elisp In Files</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="lesson-5-1-elisp-in-files">
<h1>Lesson 5-1 - Elisp In Files<a class="headerlink" href="#lesson-5-1-elisp-in-files" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>So far we have created emacs functions in the <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> file and attached that to menu-bar and the like. This is a bit sub-optimal. To use Elisp properly we should package up functionality into files and make it easy for them to be added to emacs.</p>
<p>Emacs loads files from various libraries. It used a global variable called <code class="docutils literal notranslate"><span class="pre">load-path</span></code> to work out where to load them from.</p>
<p>You can look at the current value of that global variable in the *scratch* buffer by evaluating (type in the text and type <em>[Control][j]</em> at the end):</p>
<p><code class="docutils literal notranslate"><span class="pre">load-path</span></code></p>
<p>Your install of emacs will dump out loads of directories:</p>
<p><code class="docutils literal notranslate"><span class="pre">(&quot;/usr/share/emacs23/site-lisp/thailatex&quot;</span> <span class="pre">&quot;/usr/share/emacs23/site-lisp/latex-cjk-thai&quot;</span> <span class="pre">&quot;/usr/share/emacs23/site-lisp/latex-cjk-common&quot;</span> <span class="pre">&quot;/usr/share/emacs23/site-lisp/dictionaries-common&quot;</span> <span class="pre">&quot;/etc/emacs23&quot;</span> <span class="pre">&quot;/etc/emacs&quot;</span> <span class="pre">&quot;/usr/local/share/emacs/23.1/site-lisp&quot;</span> <span class="pre">&quot;/usr/local/share/emacs/site-lisp&quot;</span> <span class="pre">&quot;/usr/share/emacs/23.1/site-lisp&quot;</span> <span class="pre">&quot;/usr/share/emacs/23.1/site-lisp/dictionaries-common&quot;</span> <span class="pre">&quot;/usr/share/emacs/23.1/site-lisp/latex-cjk-common&quot;</span> <span class="pre">&quot;/usr/share/emacs/23.1/site-lisp/latex-cjk-thai&quot;</span> <span class="pre">...)</span></code></p>
<p>For a shared production package (ie one that everyone on a particular machine will need access to) the install directory would be somewhere in the shared path space (ie a directory like <code class="docutils literal notranslate"><span class="pre">/usr/share/emacs23/site-lisp/</span></code>). The convention is that there are <code class="docutils literal notranslate"><span class="pre">site-lisp</span></code> directories for all versions of Emacs as well a for specific versions. Upgrades of the base Emacs operator can cause some packages to fail.</p>
<p>For this lesson we will store our Elisp files locally. Conventionally this is done in a directory called <code class="docutils literal notranslate"><span class="pre">.emacs.d</span></code>. Best practice says that we don’t not add <code class="docutils literal notranslate"><span class="pre">.emacs.d</span></code> to the <code class="docutils literal notranslate"><span class="pre">load-path</span></code>, but we can create a sub-directory under that and add it.</p>
<p>Create a subdirectory called <code class="docutils literal notranslate"><span class="pre">omars-dir</span></code> in <code class="docutils literal notranslate"><span class="pre">~/.emacs.d/</span></code> and inside that create a file called <code class="docutils literal notranslate"><span class="pre">myomar.el</span></code>.</p>
<p>Add versions of our old favourite functions to <code class="docutils literal notranslate"><span class="pre">myomar.el</span></code></p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">(defun</span> <span class="pre">omar-hip</span> <span class="pre">()</span></code></div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">(interactive)</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">(message</span> <span class="pre">&quot;hip,</span> <span class="pre">hop,</span> <span class="pre">don't</span> <span class="pre">stop&quot;))</span></code></div>
</div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">(defun</span> <span class="pre">omar-hotel</span> <span class="pre">()</span></code></div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">(interactive)</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">(message</span> <span class="pre">&quot;hotel,</span> <span class="pre">motel,</span> <span class="pre">holiday</span> <span class="pre">inn&quot;))</span></code></div>
</div>
</div>
<p>In order to make this available to us we need to add the path to <code class="docutils literal notranslate"><span class="pre">load-path</span></code>. This is done in our <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> file.</p>
<p><code class="docutils literal notranslate"><span class="pre">(add-to-list</span> <span class="pre">'load-path</span> <span class="pre">&quot;~/.emacs.d/omars-dir&quot;)</span></code></p>
<p>Re-evaluate the <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> buffer and then switch to the scratch buffer and evaluate <code class="docutils literal notranslate"><span class="pre">load-path</span></code> - our directory should now be the first path in the list.</p>
</div>
<div class="section" id="using-our-file">
<h2>Using Our File<a class="headerlink" href="#using-our-file" title="Permalink to this headline">¶</a></h2>
<p>We have our new directory in the <em>load-path</em> we have our file in that directory. Is that enough?</p>
<p>Quit Emacs and restart (thus losing all our history and defined functions). Our new directory should still be in the <em>load-path</em>; but will the code be loaded?</p>
<p>Emacs has an interactive command for executing interactive functions called execute-extended-command. It is bound to the key combination <em>[M-x]</em> so simply type that and the focus will switch to the mini-buffer and wait for you to enter the name of the command you want to run. Stick in <code class="docutils literal notranslate"><span class="pre">omar-hotel</span></code>. Your attempt to run it should fail.</p>
<p>Providing code in a searchable path isn’t enough. You need to add a line to the <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> file telling it to load our new file, and another line in the file itself to identify what it is that the file is providing.</p>
<p>To make life simpler we are going to call the features that our <code class="docutils literal notranslate"><span class="pre">myomar.el</span></code> file provides the same base name as the file, ie <code class="docutils literal notranslate"><span class="pre">myomar</span></code>.</p>
<p>To get this to autoload we add the following line to our <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> file after the line where we have added <code class="docutils literal notranslate"><span class="pre">~/.emacs.d/omars-dir/</span></code> to the <code class="docutils literal notranslate"><span class="pre">load-path</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">(require</span> <span class="pre">'myomar)</span></code></p>
<p>and we add this line at the top of <code class="docutils literal notranslate"><span class="pre">myomar.el</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">(provide</span> <span class="pre">'myomar)</span></code></p>
<p>Now if we quite Emacs and restart it and the use the <em>[M-x]</em> trick with <code class="docutils literal notranslate"><span class="pre">omar-hip</span></code> the function will execute.</p>
</div>
<div class="section" id="our-execution-model">
<h2>Our Execution Model<a class="headerlink" href="#our-execution-model" title="Permalink to this headline">¶</a></h2>
<p>This is the execution model we will use from now on:</p>
<ul class="simple">
<li><p>create a custom file or files in a standard directory</p></li>
<li><p>edit <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> to run an initialisation function</p></li>
</ul>
<p>The initialisation function will do a number of things:</p>
<ul class="simple">
<li><p>set up the global environment</p></li>
<li><p>change menus, tool-bars and key bindings</p></li>
<li><p>load the code that is needed</p></li>
</ul>
<p>Usually this is done conditionally via hooks. The classic route is a <em>major-mode</em> which is triggered by editing files with a certain file type. Later on we will create our own major mode for <em>omar</em>. When files whose names match <code class="docutils literal notranslate"><span class="pre">*.omar</span></code> are loaded a new mode with menus, tool-bar buttons and key bindings will <em>magically</em> appear.</p>
<p>On starting Emacs our <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> file will bind a variety of functions such that Emacs runs them when a file that matches <code class="docutils literal notranslate"><span class="pre">*.omar</span></code> is edited. These functions will load our modules as needed and dynamically customise Emacs.</p>
</div>
<div class="section" id="what-you-have-learned">
<h2>What You Have Learned<a class="headerlink" href="#what-you-have-learned" title="Permalink to this headline">¶</a></h2>
<p>You have learned:</p>
<ul class="simple">
<li><p>the basics of including code</p></li>
<li><p>how Emacs looks for modules</p></li>
<li><p>how to load some custom code into Emacs at startup</p></li>
</ul>
</div>
<div class="section" id="additional-reading">
<h2>Additional Reading<a class="headerlink" href="#additional-reading" title="Permalink to this headline">¶</a></h2>
<p>There is a slightly more to loading code in Elisp which is described in the <a class="reference external" href="http://www.gnu.org/software/emacs/emacs-lisp-intro/elisp/How-Programs-Do-Loading.html#How-Programs-Do-Loading">Loading Code</a> section of the Elisp Reference Manual.</p>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Lesson 5-1 - Elisp In Files</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#using-our-file">Using Our File</a></li>
<li><a class="reference internal" href="#our-execution-model">Our Execution Model</a></li>
<li><a class="reference internal" href="#what-you-have-learned">What You Have Learned</a></li>
<li><a class="reference internal" href="#additional-reading">Additional Reading</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="../emacs-and-the-dot-emacs-file/"
                          title="previous chapter">Emacs And The .emacs File</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../lesson-5-2-working-with-buffers-1/"
                          title="next chapter">Lesson 5-2 - Working With Buffers (1)</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../lesson-5-2-working-with-buffers-1/" title="Lesson 5-2 - Working With Buffers (1)"
             >next</a> |</li>
        <li class="right" >
          <a href="../emacs-and-the-dot-emacs-file/" title="Emacs And The .emacs File"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Learn Elisp For Emacs (Draft In Progress)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Lesson 5-1 - Elisp In Files</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010, Gordon Guthrie.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>