
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lesson 4-3 - Emacs Menus &#8212; Learn Elisp For Emacs (Draft In Progress)</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Lesson 4-4 - Adding Buttons To The Tool-bar" href="../lesson-4-4-adding-buttons-to-the-toolbar/" />
    <link rel="prev" title="Best Practice 1 - Writing Better Elisp" href="../best-practice-1-writing-better-elisp/" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../lesson-4-4-adding-buttons-to-the-toolbar/" title="Lesson 4-4 - Adding Buttons To The Tool-bar"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../best-practice-1-writing-better-elisp/" title="Best Practice 1 - Writing Better Elisp"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Learn Elisp For Emacs (Draft In Progress)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Lesson 4-3 - Emacs Menus</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="lesson-4-3-emacs-menus">
<h1>Lesson 4-3 - Emacs Menus<a class="headerlink" href="#lesson-4-3-emacs-menus" title="Permalink to this headline">¶</a></h1>
<p><strong>Prerequisite:</strong> this lesson presumes you know how to use the <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> file as outlined in Lessons 4-1 and 4-2.</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This section will look at creating a new menu in Emacs and binding a custom function to it. Before doing that we need to create a couple of functions in our <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> file to bind to the menu.</p>
<p>We will incorporate our best practice naming conventions in it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defun</span> <span class="n">omar</span><span class="o">-</span><span class="n">hip</span> <span class="p">()</span>
  <span class="s2">&quot;a nonce menu function&quot;</span>
  <span class="p">(</span><span class="n">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="n">message</span> <span class="s2">&quot;hip, hop, don&#39;t stop&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="n">defun</span> <span class="n">omar</span><span class="o">-</span><span class="n">hotel</span> <span class="p">()</span>
 <span class="s2">&quot;another nonce menu function&quot;</span>
 <span class="p">(</span><span class="n">interactive</span><span class="p">)</span>
 <span class="p">(</span><span class="n">message</span> <span class="s2">&quot;hotel, motel, holiday inn&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="the-basics-of-menus">
<h2>The Basics Of Menus<a class="headerlink" href="#the-basics-of-menus" title="Permalink to this headline">¶</a></h2>
<p>We are going to create a menu called <code class="docutils literal notranslate"><span class="pre">Omar</span></code> which calls these two functions.</p>
<p>Type the following into your <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> file and re-evaluate the buffer.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">define</span><span class="o">-</span><span class="n">key</span> <span class="k">global</span><span class="o">-</span><span class="nb">map</span> <span class="p">[</span><span class="n">menu</span><span class="o">-</span><span class="n">bar</span> <span class="n">omar</span><span class="p">]</span>
  <span class="p">(</span><span class="n">cons</span> <span class="s2">&quot;Omar&#39;s Menu&quot;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">sparse</span><span class="o">-</span><span class="n">keymap</span> <span class="s2">&quot;Omar&quot;</span><span class="p">)))</span>
</pre></div>
</div>
<p>You will see that this has created a new top-level menu at the left of the menu bar. It consists of the words <em>Omar’s Menu</em>. There are no items below it.</p>
<p>Lets look at that expression - it is defining a new key in the <code class="docutils literal notranslate"><span class="pre">global-map</span></code>. The global map is a data structure which holds details of all key inputs:</p>
<ul class="simple">
<li><p>menu items</p></li>
<li><p>toolbar items</p></li>
<li><p>key shortcuts</p></li>
<li><p>etc, etc</p></li>
</ul>
<p>You can look at the value of the global keymap by evaluating the expression <code class="docutils literal notranslate"><span class="pre">(current-global-map)</span></code> in the *scratch* buffer.</p>
<p>The next parameter is the array <code class="docutils literal notranslate"><span class="pre">[menu-bar</span> <span class="pre">omar]</span></code> which tells the global keymap that this new key is under the menu. The final item is a parameter list - in this cause just jusing a normal string as the key. The function <code class="docutils literal notranslate"><span class="pre">make-sparse-keymap</span></code> creates an empty keymap - we will fill this keymap with the menu items later.</p>
<p>You should be quite confused by the terminology now. We are creating <em>menus</em> and all the functions refer to <em>keys</em>. Emacs has a mechanism for handling keyboard events. All the other user input mechanisms (mouse events, menus, toolbar buttons, etc, etc) are all extensions of key-handling mechanisms. Hence the fact that all these things are configured by <em>key</em> related functions.</p>
<p>The menu we have just created is in the wrong place really. The standard Emacs menus are:</p>
<ul class="simple">
<li><p><em>File</em></p></li>
<li><p><em>Edit</em></p></li>
<li><p><em>Options</em></p></li>
<li><p><em>Buffers</em></p></li>
<li><p><em>Tools</em></p></li>
</ul>
<p>These constitute the <em>global</em> menu bar. In addition there is the <em>Help</em> menu - this is the <em>final items</em> menu. The Emacs convention is that user or mode-specific menus appear in the middle - that is to say to the right of the global menus and to the
left of the final items menu.</p>
<p>We can make our menu do that by changing the definition from <code class="docutils literal notranslate"><span class="pre">define-key</span></code> to <code class="docutils literal notranslate"><span class="pre">define-key-after</span></code>.</p>
<p>Now lets make a proper menu. Type the following into your <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> file and re-evaluate the buffer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">define</span><span class="o">-</span><span class="n">key</span><span class="o">-</span><span class="n">after</span> <span class="k">global</span><span class="o">-</span><span class="nb">map</span> <span class="p">[</span><span class="n">menu</span><span class="o">-</span><span class="n">bar</span> <span class="n">omar</span><span class="p">]</span>
  <span class="p">(</span><span class="n">cons</span> <span class="s2">&quot;Omar&#39;s Menu&quot;</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">sparse</span><span class="o">-</span><span class="n">keymap</span> <span class="s2">&quot;Omar&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="n">define</span><span class="o">-</span><span class="n">key</span> <span class="k">global</span><span class="o">-</span><span class="nb">map</span> <span class="p">[</span><span class="n">menu</span><span class="o">-</span><span class="n">bar</span> <span class="n">omar</span> <span class="n">omar</span><span class="o">-</span><span class="n">hip</span><span class="p">]</span>
  <span class="s1">&#39;(menu-item &quot;Hip&quot; omar-hip</span>
             <span class="p">:</span><span class="n">help</span> <span class="s2">&quot;Hip, yeah!&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="n">define</span><span class="o">-</span><span class="n">key</span> <span class="k">global</span><span class="o">-</span><span class="nb">map</span> <span class="p">[</span><span class="n">menu</span><span class="o">-</span><span class="n">bar</span> <span class="n">omar</span> <span class="n">separator</span><span class="o">-</span><span class="n">replace</span><span class="o">-</span><span class="n">tags</span><span class="p">]</span>
  <span class="s1">&#39;(menu-item &quot;--&quot;))</span>
<span class="p">(</span><span class="n">define</span><span class="o">-</span><span class="n">key</span> <span class="k">global</span><span class="o">-</span><span class="nb">map</span> <span class="p">[</span><span class="n">menu</span><span class="o">-</span><span class="n">bar</span> <span class="n">omar</span> <span class="n">omar</span><span class="o">-</span><span class="n">hotel</span><span class="p">]</span>
  <span class="s1">&#39;(menu-item &quot;Hotel&quot; omar-hotel</span>
             <span class="p">:</span><span class="n">help</span> <span class="s2">&quot;Hotel, yeah!&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Notice how we are adding menu-items down the array <code class="docutils literal notranslate"><span class="pre">[menu-bar</span> <span class="pre">omar</span> <span class="pre">omar-hip]</span></code> and so on and so forth.</p>
</div>
<div class="section" id="adding-new-items-to-an-existing-menu">
<h2>Adding New Items To An Existing Menu<a class="headerlink" href="#adding-new-items-to-an-existing-menu" title="Permalink to this headline">¶</a></h2>
<p>Lets bind the two nonce functions to an existing menu. Clear out the menu definition code from your <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> file and replace it with this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">defvar</span> <span class="n">menu</span><span class="o">-</span><span class="n">bar</span><span class="o">-</span><span class="n">omar</span><span class="o">-</span><span class="n">menu</span> <span class="p">(</span><span class="n">make</span><span class="o">-</span><span class="n">sparse</span><span class="o">-</span><span class="n">keymap</span> <span class="s2">&quot;Omar&#39;s Menu&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="n">define</span><span class="o">-</span><span class="n">key</span> <span class="n">menu</span><span class="o">-</span><span class="n">bar</span><span class="o">-</span><span class="n">omar</span><span class="o">-</span><span class="n">menu</span> <span class="p">[</span><span class="n">omar</span><span class="o">-</span><span class="n">hip</span><span class="p">]</span>
  <span class="s1">&#39;(menu-item &quot;Hip&quot; omar-hip</span>
             <span class="p">:</span><span class="n">help</span> <span class="s2">&quot;Hip, yeah!&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="n">define</span><span class="o">-</span><span class="n">key</span> <span class="n">menu</span><span class="o">-</span><span class="n">bar</span><span class="o">-</span><span class="n">omar</span><span class="o">-</span><span class="n">menu</span> <span class="p">[</span><span class="n">separator</span><span class="o">-</span><span class="n">omar</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="s1">&#39;(menu-item &quot;--&quot;))</span>
<span class="p">(</span><span class="n">define</span><span class="o">-</span><span class="n">key</span> <span class="n">menu</span><span class="o">-</span><span class="n">bar</span><span class="o">-</span><span class="n">omar</span><span class="o">-</span><span class="n">menu</span> <span class="p">[</span><span class="n">omar</span><span class="o">-</span><span class="n">hotel</span><span class="p">]</span>
  <span class="s1">&#39;(menu-item &quot;Hotel&quot; omar-hotel</span>
             <span class="p">:</span><span class="n">help</span> <span class="s2">&quot;Hotel, yeah!&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="n">define</span><span class="o">-</span><span class="n">key</span> <span class="n">menu</span><span class="o">-</span><span class="n">bar</span><span class="o">-</span><span class="n">edit</span><span class="o">-</span><span class="n">menu</span> <span class="p">[</span><span class="n">omar</span><span class="p">]</span>
       <span class="p">(</span><span class="nb">list</span> <span class="s1">&#39;menu-item &quot;Omar Menu&quot; menu-bar-omar-menu))</span>
</pre></div>
</div>
<p>Lets step through it line by line. The first line defines a new variable <code class="docutils literal notranslate"><span class="pre">menu-bar-omar-menu</span></code>. Note that it has a conventional name. It is part of the <em>menu</em> system so it has the prefix <code class="docutils literal notranslate"><span class="pre">menu-bar-</span></code>. The value of this variable is set to a <em>sparse keymap</em>. The entire input management system is built around datatypes called <em>keymaps</em>. A <em>sparse</em> keymap is just an empty uninitialised one.</p>
<p>The next three lines add elements to the sparse keymap. The first and third items are normal menu items, the second is a separator.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">define-key</span></code> operator defines a key:</p>
<ul class="simple">
<li><p>the first parameter it takes is the keymap to which the key is added</p></li>
<li><p>the second is an array with the function name the menu item is bound to</p></li>
<li><p>the third item is the value that the <code class="docutils literal notranslate"><span class="pre">menu-item</span></code> operator returns (which is why the third expression is quoted)</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">menu-item</span></code> expression takes 3 parameters:</p>
<ul class="simple">
<li><p>the string that appears in the menu</p></li>
<li><p>the function that is associated with the menu</p></li>
<li><p>the final parameter is a property list (ie 2 elements) containing the constant variable <code class="docutils literal notranslate"><span class="pre">:help</span></code> and the help string which appears as the tooltip on the menu</p></li>
</ul>
<p>Notice how we built this menu in a different way - creating a new keymap, adding elements into it, and finally sticking the new keymap into a keymap <code class="docutils literal notranslate"><span class="pre">menu-bar-edit-menu</span></code> which is already bound into the global-map.</p>
</div>
<div class="section" id="keyboard-shortcuts">
<h2>Keyboard Shortcuts<a class="headerlink" href="#keyboard-shortcuts" title="Permalink to this headline">¶</a></h2>
<p>Keyboard shortcuts are automatically added to menus if they exist. To try this out bind one of the functions to a key combination. Add a key binding to <code class="docutils literal notranslate"><span class="pre">.emacs</span></code> and reevaluate the buffer.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="k">global</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">key</span> <span class="p">[</span><span class="n">f5</span><span class="p">]</span> <span class="s1">&#39;omar-hip)</span>
</pre></div>
</div>
<p>When you look at the menu now you should see the keyboard shortcut <code class="docutils literal notranslate"><span class="pre">&lt;f5&gt;</span></code> alongside the menu item <em>Hip</em>.</p>
</div>
<div class="section" id="what-you-have-learned">
<h2>What You Have Learned<a class="headerlink" href="#what-you-have-learned" title="Permalink to this headline">¶</a></h2>
<p>You have seen how to add basic menu items which bind to functions.</p>
</div>
<div class="section" id="additional-reading">
<h2>Additional Reading<a class="headerlink" href="#additional-reading" title="Permalink to this headline">¶</a></h2>
<p>There is a section on <a class="reference external" href="http://www.gnu.org/software/emacs/emacs-lisp-intro/elisp/Keymaps.html#Keymaps">Keymaps</a> in the <em>Introduction To Emacs Lisp</em> Manual - it includes a section on menu manipulation.</p>
</div>
<div class="section" id="extra-activities">
<h2>Extra Activities<a class="headerlink" href="#extra-activities" title="Permalink to this headline">¶</a></h2>
<p>You can alter the layout of your menus with a variety of <a class="reference external" href="http://www.gnu.org/software/emacs/elisp/html_node/Menu-Separators.html#Menu-Separators">Menu Separators</a> create a new menu with some swanky separators.</p>
<p>We have build menus with single items - can you build sub-menus and sub-sub-menus?</p>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Lesson 4-3 - Emacs Menus</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#the-basics-of-menus">The Basics Of Menus</a></li>
<li><a class="reference internal" href="#adding-new-items-to-an-existing-menu">Adding New Items To An Existing Menu</a></li>
<li><a class="reference internal" href="#keyboard-shortcuts">Keyboard Shortcuts</a></li>
<li><a class="reference internal" href="#what-you-have-learned">What You Have Learned</a></li>
<li><a class="reference internal" href="#additional-reading">Additional Reading</a></li>
<li><a class="reference internal" href="#extra-activities">Extra Activities</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="../best-practice-1-writing-better-elisp/"
                          title="previous chapter">Best Practice 1 - Writing Better Elisp</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../lesson-4-4-adding-buttons-to-the-toolbar/"
                          title="next chapter">Lesson 4-4 - Adding Buttons To The Tool-bar</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../lesson-4-4-adding-buttons-to-the-toolbar/" title="Lesson 4-4 - Adding Buttons To The Tool-bar"
             >next</a> |</li>
        <li class="right" >
          <a href="../best-practice-1-writing-better-elisp/" title="Best Practice 1 - Writing Better Elisp"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../">Learn Elisp For Emacs (Draft In Progress)</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Lesson 4-3 - Emacs Menus</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010, Gordon Guthrie.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>