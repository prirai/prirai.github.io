<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML
><HEAD
><TITLE
>Kerberos Infrastructure HOWTO</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><link rel="stylesheet" href="../bookstyle.css"></HEAD
><BODY
CLASS="article"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="title"
><A
NAME="AEN2"
></A
>Kerberos Infrastructure HOWTO</H1
><H3
CLASS="author"
><A
NAME="AEN4"
>V. Alex Brennen</A
></H3
><DIV
CLASS="affiliation"
><DIV
CLASS="address"
><P
CLASS="address"
><TT
CLASS="email"
>&#60;<A
HREF="mailto:vab@cryptnet.net"
>vab@cryptnet.net</A
>&#62;</TT
></P
></DIV
></DIV
><P
CLASS="pubdate"
>2004-05-29<BR></P
><DIV
CLASS="revhistory"
><TABLE
WIDTH="100%"
BORDER="0"
><TR
><TH
ALIGN="LEFT"
VALIGN="TOP"
COLSPAN="3"
><B
>Revision History</B
></TH
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 2.0.0</TD
><TD
ALIGN="LEFT"
>2004-05-28</TD
><TD
ALIGN="LEFT"
>Revised by: VAB</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Conversion to DocBook XML. General Content Updates,
		including incorporation of Technical and Metadata/Markup Reviews.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 1.0.3</TD
><TD
ALIGN="LEFT"
>2003-04-01</TD
><TD
ALIGN="LEFT"
>Revised by: VAB</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Minor Updates, Minor Corrections, Additional links added.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 1.0.2</TD
><TD
ALIGN="LEFT"
>2002-09-13</TD
><TD
ALIGN="LEFT"
>Revised by: VAB</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Minor Updates, Minor Corrections, Added 8.6, Additional links added.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 1.0.1</TD
><TD
ALIGN="LEFT"
>2002-07-15</TD
><TD
ALIGN="LEFT"
>Revised by: VAB</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Minor Updates, Fixes.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 1.0.0</TD
><TD
ALIGN="LEFT"
>2002-06-13</TD
><TD
ALIGN="LEFT"
>Revised by: VAB</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Initial Release.</TD
></TR
></TABLE
></DIV
><DIV
><DIV
CLASS="abstract"
><A
NAME="AEN45"
></A
><P
></P
><P
>This document describes the design and configuration of a Kerberos infrastructure for handling authentication with GNU/Linux. It details steps for a best practices method of setting up servers, Kerberos software, conversion of legacy systems, and answers frequently asked questions.</P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
>1. <A
HREF="#about"
>About this Document</A
></DT
><DD
><DL
><DT
>1.1. <A
HREF="#general"
>General Information</A
></DT
><DT
>1.2. <A
HREF="#translations"
>Translations</A
></DT
><DT
>1.3. <A
HREF="#credits"
>Credits and Contributors</A
></DT
><DT
>1.4. <A
HREF="#feedback"
>Feedback</A
></DT
></DL
></DD
><DT
>2. <A
HREF="#overview"
>An Overview of a Kerberos Infrastructure</A
></DT
><DD
><DL
><DT
>2.1. <A
HREF="#intro"
>An Introduction to Kerberos</A
></DT
><DT
>2.2. <A
HREF="#benefits"
>The Benefits of Kerberos</A
></DT
><DT
>2.3. <A
HREF="#howitworks"
>How Kerberos Works</A
></DT
><DT
>2.4. <A
HREF="#compromise"
>Compromise of Kerberos Infrastructure</A
></DT
></DL
></DD
><DT
>3. <A
HREF="#install"
>Installing and Configuration</A
></DT
><DD
><DL
><DT
>3.1. <A
HREF="#machine-configure"
>General Machine Configuration Overview</A
></DT
><DT
>3.2. <A
HREF="#hardware"
>Hardware</A
></DT
><DT
>3.3. <A
HREF="#gnulinux-install"
>GNU/Linux Installation</A
></DT
><DT
>3.4. <A
HREF="#realm"
>Choosing A Realm</A
></DT
><DT
>3.5. <A
HREF="#configure"
>Kerberos Software Configuration</A
></DT
><DT
>3.6. <A
HREF="#principal-creation"
>Principal Creation</A
></DT
></DL
></DD
><DT
>4. <A
HREF="#time-sync"
>Time Synchronization</A
></DT
><DD
><DL
><DT
>4.1. <A
HREF="#time-sync-importance"
>The Importance of Time Synchronization</A
></DT
><DT
>4.2. <A
HREF="#intro-ntp"
>Introduction to NTP</A
></DT
><DT
>4.3. <A
HREF="#ntp-install"
>NTP Installation and Configuration</A
></DT
></DL
></DD
><DT
>5. <A
HREF="#server-replication"
>Kerberos Server Replication</A
></DT
><DD
><DL
><DT
>5.1. <A
HREF="#replication"
>Description of Replication</A
></DT
><DT
>5.2. <A
HREF="#implementation"
>Implementation</A
></DT
><DT
>5.3. <A
HREF="#maintain"
>Maintenance</A
></DT
></DL
></DD
><DT
>6. <A
HREF="#client-configure"
>Client Configuration</A
></DT
><DD
><DL
><DT
>6.1. <A
HREF="#client"
>General GNU/Linux Client Configuration</A
></DT
><DT
>6.2. <A
HREF="#pam"
>PAM</A
></DT
><DT
>6.3. <A
HREF="#apache"
>Apache Web Server</A
></DT
><DT
>6.4. <A
HREF="#microsoft"
>Microsoft Windows</A
></DT
></DL
></DD
><DT
>7. <A
HREF="#programming"
>Programming With Kerberos</A
></DT
><DD
><DL
><DT
>7.1. <A
HREF="#api"
>The Kerberos API</A
></DT
></DL
></DD
><DT
>A. <A
HREF="#sources"
>Relevant Sources for More Information</A
></DT
><DD
><DL
><DT
>A.1. <A
HREF="#links"
>Links to related documents</A
></DT
><DT
>A.2. <A
HREF="#websites"
>Related web sites</A
></DT
><DT
>A.3. <A
HREF="#rfc"
>Related RFCs</A
></DT
><DT
>A.4. <A
HREF="#other-ref"
>Other references</A
></DT
><DT
>A.5. <A
HREF="#resources"
>Additional resources</A
></DT
><DT
>A.6. <A
HREF="#companies"
>Companies which provide specialist Kerberos consulting</A
></DT
></DL
></DD
><DT
><A
HREF="#AEN477"
>Glossary of Terms</A
></DT
></DL
></DIV
><DIV
CLASS="section"
><H1
CLASS="section"
><A
NAME="about"
></A
>1. About this Document</H1
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="general"
></A
>1.1. General Information</H2
><P
>&#13;Copyright (c) 2002-2004  <A
HREF="http://cryptnet.net/people/vab/"
TARGET="_top"
>V. Alex Brennen</A
> (<A
HREF="http://cryptnet.net/people/vab/"
TARGET="_top"
>VAB</A
>).
</P
><P
>&#13;This document is hereby placed in the public domain.
</P
><P
>&#13;This document lives at <A
HREF="http://cryptnet.net/fdp/admin/kerby-infra/en/kerby-infra.html"
TARGET="_top"
>http://cryptnet.net/fdp/admin/kerby-infra/en/kerby-infra.html</A
>
</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="translations"
></A
>1.2. Translations</H2
><P
>&#13;This document is currently only available in the following languages:
</P
><P
></P
><UL
><LI
><P
>&#13;[<A
HREF="http://cryptnet.net/fdp/admin/kerby-infra/en/kerby-infra.html"
TARGET="_top"
>en</A
>] English
</P
></LI
></UL
><P
>&#13;If you know of a translation or would like to translate it to another language please <A
HREF="mailto:vab@cryptnet.net"
TARGET="_top"
>let me know</A
> so that I can distribute or link to the translated versions.
</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="credits"
></A
>1.3. Credits and Contributors</H2
><P
></P
><UL
><LI
><P
>&#13;<A
HREF="http://cryptnet.net/people/vab/"
TARGET="_top"
>V. Alex Brennen</A
> (<A
HREF="http://cryptnet.net/people/vab/"
TARGET="_top"
>VAB</A
>) <TT
CLASS="email"
>&#60;<A
HREF="mailto:vab (at) cryptnet.net"
>vab (at) cryptnet.net</A
>&#62;</TT
> (Principal Author)
</P
></LI
><LI
><P
>&#13;<A
HREF="http://kolya.net/"
TARGET="_top"
>Nickolai Zeldovich</A
> <TT
CLASS="email"
>&#60;<A
HREF="mailto:kolya (at) zepa.net"
>kolya (at) zepa.net</A
>&#62;</TT
> (Technical suggestions, technical corrections)
</P
></LI
></UL
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="feedback"
></A
>1.4. Feedback</H2
><P
>&#13;Please send any additions, comments, corrections and criticisms to the following email address: <TT
CLASS="email"
>&#60;<A
HREF="mailto:vab@cryptnet.net"
>vab@cryptnet.net</A
>&#62;</TT
>.
</P
></DIV
></DIV
><DIV
CLASS="section"
><HR><H1
CLASS="section"
><A
NAME="overview"
></A
>2. An Overview of a Kerberos Infrastructure</H1
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="intro"
></A
>2.1. An Introduction to Kerberos</H2
><P
>&#13;Kerberos is a system of authentication developed at MIT as part of the Athena project. Kerberos uses encryption technology and a trusted third party, an arbitrator, to perform secure authentication on an open network.  Specifically, Kerberos uses cryptographic tickets in order to avoid transmitting plain text passwords over the wire. Kerberos was based upon the Needham-Schroeder protocol.
</P
><P
>&#13;There are two versions of Kerberos currently in use, version 4 and version 5. Kerberos versions 1 through 3 were internal development versions and never released. Kerberos version 4 has a number of known weaknesses and should no long be used. This document deals only with Kerberos 5.  Kerberos 5 is defined in <A
HREF="http://cryptnet.net/mirrors/rfcs/rfc1510.txt"
TARGET="_top"
>RFC1510</A
>.
</P
><P
>&#13;The term Kerberos Infrastructure refers to the software, servers, and client configurations that will allow an administrator to use the Kerberos protocol to perform authentication on their network.  Specifically, Kerberos Infrastructure consists of the Kerberos software itself, secured redundant authentication servers, a centralized account and password store, and systems configured to authenticate through the Kerberos protocol.  This document will take you through the steps to install, configure, and deploy such an infrastructure.
</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="benefits"
></A
>2.2. The Benefits of Kerberos</H2
><P
>&#13;For individuals unfamiliar with the Kerberos protocol, the benefits of deploying it in their network may not be clear.  However, all administrators are familiar with the problems Kerberos was designed to mitigate.  Those problems include, password sniffing, password filename/database stealing, and the high level of effort necessary to maintain a large number of account databases.
</P
><P
>&#13;A properly deployed Kerberos Infrastructure will help you address these problems.  It will make your enterprise more secure.  Use of Kerberos will prevent plaintext passwords from being transmitted over the network.  The Kerberos system will also centralize your username and password information which will make it easier to maintain and manage this data. Finally, Kerberos will also prevent you from having to store password information locally on a machine, whether it is a workstation or server, thereby reducing the likelihood that a single machine compromise will result in additional compromises.
</P
><P
>&#13;To summarize, in a large enterprise, the benefits of Kerberos will translate into reduced administration costs through easier account and password management and through improved network security.  In a smaller environment, scalable authentication infrastructure and improved network security are the clear benefits.
</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="howitworks"
></A
>2.3. How Kerberos Works</H2
><P
>&#13;Kerberos is an authentication protocol which uses a shared secret and a trusted third party arbitrator in order to validate the identity of clients.  In Kerberos, clients may be users, servers, or pieces of software.  The trusted third party arbitrator is a server known as a Key Distribution Center (KDC) which runs the Kerberos daemons.  The shared secret is the users password transformed into a cryptographic key.  In the case of servers or software systems, a random key is generated.
</P
><P
>&#13;In Kerberos, users are known as principals. The KDC has a database of principals and their secret keys which is uses to perform authentication. In Kerberos knowledge of the secret key is considered sufficient for proof of identity.  Since knowledge of a secret key translates into proof of identity in Kerberos, the Kerberos server can be trusted to authenticate any client to any other client. Authentication is Kerberos is done with out sending any clear text passwords across the wire. Below I'll explain how the Kerberos protocol maps to the GNU/Linux Kerberos software.
</P
><P
>&#13;The KDC runs two important Kerberos daemons.  These daemons are <SPAN
CLASS="application"
>kadmind</SPAN
> and <SPAN
CLASS="application"
>krb5kdc</SPAN
>. While GNU/Linux daemon naming conventions suggests that processes which have names starting with <SPAN
CLASS="QUOTE"
>"k"</SPAN
> are Kernel related or Kernel space processes, this is not true in the case of <SPAN
CLASS="application"
>krb5kdc</SPAN
> and <SPAN
CLASS="application"
>kadmind</SPAN
>. These two daemons are run as root in user space.
</P
><P
>&#13;<SPAN
CLASS="application"
>kadmind</SPAN
> is the administrative daemon for the Kerberos server. <SPAN
CLASS="application"
>kadmind</SPAN
> is used by a program named <SPAN
CLASS="application"
>kadmin</SPAN
> to maintain the database of principals and policy configuration.  If you choose to disallow any remote logins via <SPAN
CLASS="application"
>ssh</SPAN
> on your Kerberos hardware, <SPAN
CLASS="application"
>kadmin</SPAN
> will allow you to remotely administer the Kerberos components of the server.
</P
><P
>&#13;<SPAN
CLASS="application"
>krb5kdc</SPAN
> is the workhorse of the Kerberos server. It is responsible for performing the role of the trusted third party arbitrator in Kerberos authentication. When a user wants to authenticate himself to a system or service, the user requests a ticket from the KDC. A ticket is a datagram consisting of the client's identity, a session key, a timestamp, and some other information. The datagram is encrypted with the server's secret key.
</P
><P
>&#13;In detail that process works as follows,  first the request for authentication is sent to the <SPAN
CLASS="application"
>krb5kdc</SPAN
> daemon.  When the daemon received this request, it looks up the client, the principal, trying to authenticate in the principal database. It reads the clients secret key from this database and encrypts a special ticket called a Ticket Granting Ticket (TGT) which it then sends back the client. The client receives this encrypted TGT which contains a session key.  If the client knows the password (the secret key stored in the principal database) and can successfully decrypt the TGT, it can present the ticket encrypted with the enclosed session key to a Ticket Granting Service (TGS).  The TGS will then issue a subsequent ticket which will provide the client with the authentication they need to use a specific system or service.
</P
><P
>&#13;Through the use of encrypted tickets which can only be decrypted if the client knows the secret key, secure authentication takes place.  Time stamp information is included in the tickets to prevent replay attacks.  A replay attack would be the fraudulent representation of a previously issued ticket in order to gain unauthorized access.
</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="compromise"
></A
>2.4. Compromise of Kerberos Infrastructure</H2
><P
>&#13;The primary way in which an attacker will attempt to compromise a Kerberos Infrastructure would be to attack the Kerberos servers.  If an attacker can gain root access to a KDC, the attacker will have access to the database of encrypted passwords of the principals.  The attacker will also have access to the Kerberos software and configuration files both of which they can then modify to make the system perform authentications which should not be successful.
</P
><P
>&#13;Other methods of attacking Kerberos infrastructure include replay attacks and password-guessing attacks. A replay attack would involve intercepting or otherwise acquiring a Kerberos ticket and then fraudulently representing that ticket in an attempt to gain authentication. Password guessing in a Kerberos system could be done by intercepting Kerberos tickets from the network and then making a brute force attempt to decrypt the intercepted tickets.
</P
><P
>&#13;An attacker may exploit outdated software in the infrastructure.  For example, there are many problems with Kerberos version 4. Most importantly, Kerberos version 4 has a basic protocol weakness in the encryption used. The design of Kerberos 4 included the use of DES in standard mode which allows attackers to intercept and modify the ciphertext of Kerberos tickets in an undetectable way. In order to prevent these attacks, Kerberos 5 has been modified to use triple DES in Cipher Block Chaining (CBC) mode.
</P
><P
>&#13;When discussing the strength of Kerberos 4, it is also important to note that many implementations of Kerberos version 4 have buffer overflow vulnerabilities. While the reference implementations of version 5 fixed the buffer overflow weaknesses in version 4, distributions of Kerberos 5 usually ship with software to provide backward compatibility to support legacy Kerberos 4 applications.  Some of the backward compatibility code for version 4 support in Kerberos version 5 releases is still believed to be vulnerable to buffer overflow attacks.
</P
><P
>&#13;Therefore, due to the protocol weaknesses in version 4 and the potential for buffer overflow attacks with version 4 implementations and version 4 backward compatibility code, it is best not to support or use Kerberos version 4.
</P
><P
>&#13;In summary, from this description on how a Kerberos infrastructure can be compromised, we realize that we must give great priority to the security of the Kerberos servers themselves, run up to date Kerberos software, and remain vigilant in picking good passwords and in setting good password policy.
</P
></DIV
></DIV
><DIV
CLASS="section"
><HR><H1
CLASS="section"
><A
NAME="install"
></A
>3. Installing and Configuration</H1
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="machine-configure"
></A
>3.1. General Machine Configuration Overview</H2
><P
>&#13;This section of the document describes the installation and configuration of the machines and software which will function as the KDCs.  You may want to make some adjustments to the configurations suggested, but there are a few key points presented that are very important to remember when configuring your KDCs.  So, if you do decide on an alternative  configuration strategy make sure you understand the material presented here.
</P
><P
>&#13;The machines will run the Kerberos daemon and store password and policy data.  Therefore, it's very important to the security of the network that these servers remain secure.  We should take every possible measure to prevent these servers from being compromised.  Pay particular attention to the security advice given in this section.
</P
><P
>&#13;The key points of that security advice are that you should dedicate hardware to providing Kerberos KDC service.  You should physically secure that hardware, and you should harden GNU/Linux as much as possible on that hardware.  If a KDC is compromised, your entire Kerberos infrastructure is compromised.
</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="hardware"
></A
>3.2. Hardware</H2
><P
>&#13;Kerberos service does not place a great demand on hardware and the Kerberos services have a capability for redundancy, therefore server hardware can be minimal. For the Kerberos servers which I've deployed I've used uniprocessor PIII machines with two hardware RAID 1 drives.  These machines are meant to handle between forty and one hundred thousand authentications per day. While servers may be deployed with redundant NIC cards, having both cards active simultaneously should be avoided. Kerberos includes the IP of the KDC in tickets, therefore difficulties authenticating may occur if the KDC is contacted on multiple interfaces by a client during an authentication session.
</P
><P
>&#13;It is important to note that Kerberos service should be run on dedicated hardware. Dedicating a machine to Kerberos means that only the Kerberos administrator will need to log in on those machines. It also means that no other services, except perhaps SSH, will be run on the machines. Since all of your users passwords are stored on the Kerberos servers, it is a good idea to limit access as much as possible to the hardware.  Along with dedicating servers to Kerberos, you should also physically secure your servers as much as possible.  For Kerberos servers, this may include locking the servers in a cabinet and having a dedicated terminal attached to them.
</P
><P
>&#13;In order to take advantage of Kerberos' built in capability for redundancy, you must have at least two machines running as KDCs.  Kerberos is designed to be deployed with one primary master server, and one or more secondary slave servers.  You may have as many secondary servers as you would like.
</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="gnulinux-install"
></A
>3.3. GNU/Linux Installation</H2
><P
>&#13;The servers we're installing GNU/Linux on will be dedicated to the task of performing Kerberos service, therefore we can take some extra steps to secure them.
</P
><P
>&#13;First, we'll only install software that is absolutely necessary for Kerberos service. This includes the base operating system and the Kerberos packages. We should not install X or any GUI applications. SSH is optional. SSH may be installed if you wish to be able to administer the servers remotely.  However, the servers would be significantly more secure if you only provide login access to them through an attached terminal.
</P
><P
>&#13;In Fedora Core based GNU/Linux, the packages required to provide Kerberos service are:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;krb5-server
krb5-libs
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;Documentation and development libraries should not be installed on the KDC, since we do not want to use this machine for anything but the performance of KDC service.
</P
><P
>&#13;The next step will be to make sure that no ports are open that do not need to be and that any necessary security patches that are needed are applied.  The methodology to determining what security patches need to be applied is depended up what package management software is installed.  To determine what ports the machine is currently listening on, the <SPAN
CLASS="application"
>netstat</SPAN
> command can be used.  For example, on a machine which only ssh running we should see the following:
</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;bash$ netstat -an | grep -i listen | less
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;Finally, we'll configure the server to restrict access only to servers that need to talk to it for authentication. This should be done by editing <TT
CLASS="filename"
>/etc/hosts.allow</TT
> and <TT
CLASS="filename"
>/etc/hosts.deny</TT
> as well as with <TT
CLASS="filename"
>iptables</TT
>.
</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="realm"
></A
>3.4. Choosing A Realm</H2
><P
>&#13;Realm names are case sensitive and must be unique on your network. It is a standard best practice to use your second level domain name in all uppercase letters as your realm name. If you are setting up Kerberos for only a subnet rather than your entire network, you should use the trailing domain name of the subnet.
</P
><P
>&#13;When determining your realm topology, you should take the overall structure of your organization into account. If your organization has one or more remote offices or independent sub groups, they may be best included under a separate realm. Kerberos realm topology should mirror system management topology rather than physical network topology.
</P
><P
>&#13;Finally, legacy systems should also be taken into account. For example, legacy Kerberos deployments or existing network topology grouping which you wish to preserve (i.e. Windows NT domains).
</P
><P
>&#13;If you are installing Kerberos on a network which already has Kerberos deployed in the overall network or in a subnet, you must avoid a realm name collision. The most common occurrence of deploying Kerberos on a network with a preexisting Kerberos installation occurs when working with a network that includes an IBM SP cluster.  The best solution is to create a realm specifically for the SP cluster at third or high domain name level and then use a second level domain name for your primary Kerberos realm.
</P
><P
>&#13;In this document, we'll use an example to help illustrate the design and configuration of an infrastructure.  For our example, we'll use a mythical university which was founded to educate people with, and perform research in the area of, free content - Gnu University in Dublin, Ireland.  The Gnu University Dublin example will include two Kerberos servers used to authenticate students and faculty.  The TLD for the university is gnud.ie, therefore we'll use the Kerberos realm of GNUD.IE.
</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="configure"
></A
>3.5. Kerberos Software Configuration</H2
><P
>&#13;Now, you'll need to configure Kerberos, create an administrator, determine a policy, and initialize the Kerberos principal database.
</P
><P
>&#13;The first step is to edit the <TT
CLASS="filename"
>/etc/krb5.conf</TT
> configuration file.  In this file you'll need to set your realm, expand on the realm definition by specifying the Kerberos servers, and finally setting the domain realm.  For our example, this is done as follows:
</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;default_realm = GNUD.IE

[realms]
 GNUD.IE = {
  kdc = kerberos1.gnud.ie:88
  kdc = kerberos2.gnud.ie:88
  admin_server = kerberos1.gnud.ie:749
  default_domain = gnud.ie
 }

[domain_realm]
 .gnud.ie = GNUD.IE
 gnud.ie = GNUD.IE
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;To initialize and create the Kerberos database, you must run the follow command:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;{Kerberos1}bash# /usr/Kerberos/sbin/kdb5_util create -s
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;The <EM
>-s</EM
> flag tell the KDC to create a stash file to authenticate itself. You may also use a <EM
>-r</EM
> flag to specify a realm.  Specifying a realm for the new database is only necessary if you have more than one realm defined in your <TT
CLASS="filename"
>krb5.conf</TT
> file.
</P
><P
>&#13;Kerberos will then ask you to set the master password for your Kerberos database.  It is very important that you do not forget this password.  You will not be able to administrate your server if you do not remember the master password.
</P
><P
>&#13;Next on the KDC you must edit the acl file to grant administrative access. Typically, this file is located at <TT
CLASS="filename"
>/var/Kerberos/krb5kdc/kadm5.acl</TT
>. If necessary, specify the acl file location in your <TT
CLASS="filename"
>kdc.conf</TT
> file.  The location of your <TT
CLASS="filename"
>kdc.conf</TT
> file is specified in your <TT
CLASS="filename"
>/etc/krb5.conf</TT
> file and defaults to <TT
CLASS="filename"
>/var/Kerberos/krb5kdc/kdc.conf</TT
>.  For our GNU University Dublin example, we'll modify the acl file to include the following contents:
</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;*/admin@GNUD.IE     *
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;The meaning of those acl contents are that any account which ends with a /admin in the <EM
>GNUD.IE</EM
> realm is granted full access privileges.
</P
><P
>&#13;Now that we've set up access for our administrative user, we need to create that administrative user. You can do this with the <SPAN
CLASS="application"
>kadmin.local</SPAN
> command from a root shell on the KDC, using the <SPAN
CLASS="application"
>addprinc</SPAN
> sub command.  The standard is to name the administrative account <EM
>admin</EM
>.  For the Gnu University Dublin Kerberos Administrator, the following command would accomplish this:
</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;{Kerberos1}bash# /usr/Kerberos/sbin/kadmin.local -q "addprinc admin/admin"
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;The daemons that must run on the server are <SPAN
CLASS="application"
>krb5kdc</SPAN
> and <SPAN
CLASS="application"
>kadmin</SPAN
>. If necessary, <SPAN
CLASS="application"
>krb524</SPAN
> may also be run to provide backward compatibility to Kerberos 4 clients.  However, before starting <SPAN
CLASS="application"
>krb524</SPAN
> remember our security warning about Kerberos V4 and be sure that you really need to provide that functionality. On the KDCs <SPAN
CLASS="application"
>krb5kdc</SPAN
> and <SPAN
CLASS="application"
>kadmin</SPAN
> should be configured to start automatically by turning them on with the <SPAN
CLASS="application"
>chkconfig</SPAN
> command.
</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;{Kerberos1}bash# /sbin/chkconfig krb5kdc on
{Kerberos1}bash# /sbin/chkconfig kadmin on
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;Finally, we can start them up manually, with the following command:
</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;{Kerberos1}bash# /etc/rc.d/init.d/krb5kdc start
{Kerberos1}bash# /etc/rc.d/init.d/kadmin start
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;and we have a working KDC.
</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="principal-creation"
></A
>3.6. Principal Creation</H2
><P
>&#13;You can create the first user principal in Kerberos with the following command:
</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;{Kerberos1}bash# kadmin.local
{Kerberos1}kadmin.local: addprinc &#60;username&#62;
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;A script could be written to create principals in bulk if you have a large number of account which you will be supporting with Kerberos.
</P
></DIV
></DIV
><DIV
CLASS="section"
><HR><H1
CLASS="section"
><A
NAME="time-sync"
></A
>4. Time Synchronization</H1
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="time-sync-importance"
></A
>4.1. The Importance of Time Synchronization</H2
><P
>&#13;Since the security of Kerberos authentication is in part based upon the time stamps of tickets, it is critical to have accurately set clocks on Kerberos servers. As we mentioned in the introduction to Kerberos, a short lifetime for tickets is used to prevent attackers from performing successful brute force attacks or replay attacks.
</P
><P
>&#13;If you allow your clocks of your servers to drift, you will make your network vulnerable to such attacks.  Since clock synchronization is so important in the security of the Kerberos protocol, if clocks are not synchronized with in a reasonable window Kerberos will report fatal errors and refuse to function.  Clients attempting to authenticate from a machine with an inaccurate clock will be failed by the KDC in authentication attempts due to the time difference with the KDC's clock.
</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="intro-ntp"
></A
>4.2. Introduction to NTP</H2
><P
>&#13;The Network Time Protocol (NTP) is available for the time synchronization of servers. A number of public NTP servers are available for synchronization.  NTP is capable of synchronizing client clocks within milliseconds on LANs, and tens of milliseconds over WANs. NTP servers are divided by stratum.  Primary NTP servers are classified as stratum 1. These public primary servers should not be used for synchronization of client machines due to the relatively small number of them. Public stratum 2 servers are available for client machine synchronization and synchronize their own clocks with the public stratum 1 servers. For our Kerberos servers, we'll set up NTP to query against three stratum two servers.  A maintained
list of public stratum two servers can be <A
HREF="http://www.eecis.udel.edu/~mills/ntp/clock2b.html"
TARGET="_top"
>found here</A
>.
</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="ntp-install"
></A
>4.3. NTP Installation and Configuration</H2
><P
>&#13;In order to turn NTP on GNU/Linux, you must install the NTP package and edit the configuration filename.  By default, the NTP configuration filename is <TT
CLASS="filename"
>/etc/ntp.conf</TT
>. The default values in the configuration are acceptable.  All that needs to be done is to add the servers we wish to use to synchronize our clocks.  Authentication is not necessary, but authentication can be enabled from additional security.  If you're using NTP servers on your LAN, you may wish to use authentication. Here is a sample <TT
CLASS="filename"
><A
HREF="http://cryptnet.net/fdp/admin/kerby-infra/en/ntp.conf"
TARGET="_top"
>ntp.conf</A
></TT
> filename from the Gnu University Dublin.
</P
><P
>&#13;Finally we put a cron job in place to do the actual synchronization:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;30 * * * * /usr/sbin/ntpdate -s
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;If our systems are behind a firewall we may need to provide use <EM
>-su</EM
> rather than just <EM
>-s</EM
>.  The <EM
>-u</EM
> argument will direct ntpdate to use an unprivileged port for its outgoing connection to the stratum 2 time servers.
</P
></DIV
></DIV
><DIV
CLASS="section"
><HR><H1
CLASS="section"
><A
NAME="server-replication"
></A
>5. Kerberos Server Replication</H1
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="replication"
></A
>5.1. Description of Replication</H2
><P
>&#13;Kerberos was designed to allow for a Master/Slave replication cluster.  While a Kerberos cluster can consist of any number of hosts, it is recommended that you have at least two.  A master which serves as the primary server and at least one slave which is available as a backup to the master.  The master and slave servers may be thought of as Primary and Secondary servers respectively.
</P
><P
>&#13;Kerberos stores all of its information, both account and policy data, in application databases.  The Kerberos software distribution includes software for replicating, or copying, this data to other servers.
</P
><P
>&#13;Kerberos client applications are designed to attempt authentication against secondary servers if the primary master is down.  Therefore you do not need to do any extra work during a system failure to fail over your Kerberos authentication service to the backup server.  However, the administrative features of Kerberos do not provide for automatic failover.
</P
><P
>&#13;In the event that your primary server fails, <SPAN
CLASS="application"
>kadmind</SPAN
> will be unavailable. Therefore, administrative functions will be unavailable until the primary server is restored or replace.  Specifically, principal management, key creation, and key changes, cannot be done during a primary server failure.
</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="implementation"
></A
>5.2. Implementation</H2
><P
>&#13;Server replication is handled by the <SPAN
CLASS="application"
>kprop</SPAN
> command. <SPAN
CLASS="application"
>kprop</SPAN
> must be run on the primary master KDC.  It should be run in a scheduled cron job to keep the principal database in sync across all servers.
</P
><P
>&#13;The first step in setting up replication, is to set up ACLs for <SPAN
CLASS="application"
>kpropd</SPAN
>.  The <SPAN
CLASS="application"
>kpropd</SPAN
> acl filename is by default located at <TT
CLASS="filename"
>/var/Kerberos/krb5kdc/kpropd.acl</TT
>.  In our example, it would have the following contents:
</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;host/kerberos1.gnud.ie@GNUD.IE
host/kerberos2.gnud.ie@GNUD.IE
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;The <TT
CLASS="filename"
>kpropd.acl</TT
> file should only exist on the slave Kerberos server. In Fedora derived GNU/Linux, <SPAN
CLASS="application"
>kadmin</SPAN
> will not run on a Kerberos server on which <TT
CLASS="filename"
>/var/Kerberos/krb5kdc/kpropd.acl</TT
> exists.
</P
><P
>&#13;Next you'll need to create host keys for your master and slave Kerberos servers:
</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;{Kerberos1}bash# kadmin.local
{Kerberos1}kadmin.local:  addprinc -randkey host/kerberos1.gnud.ie
{Kerberos1}kadmin.local:  addprinc -randkey host/kerberos2.gnud.ie
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;The next step is to extract these keys to the keytab file.  The keytab file is a keyring which contains the cryptographic keys
needed to authenticate with the KDC.  Extraction of keys to the keytab is done with the <SPAN
CLASS="application"
>ktadd</SPAN
> sub command:
</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;{Kerberos1}kadmin.local:  ktadd host/kerberos1.gnud.ie
{Kerberos1}kadmin.local:  ktadd host/kerberos2.gnud.ie
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;Finally, we want to copy the keytab over to the slave server so that it has the keys it needs available to authenticate.
</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;{Kerberos2}bash# scp root@kerberos1.gnud.ie:/etc/krb5.keytab /etc
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;Here is a crontab entry from the master Kerberos server used to synchronize principal databases every fifteen minutes:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;15 * * * * /usr/local/bin/krb5prop.sh
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;Here are the contents of the <TT
CLASS="filename"
>krb5prop.sh</TT
> script:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;#!/bin/sh

/usr/Kerberos/sbin/kdb5_util dump /var/Kerberos/krb5kdc/slave_datatrans

/usr/Kerberos/sbin/kprop -f /var/Kerberos/krb5kdc/slave_datatrans kerberos2.gnud.ie &#62; /dev/null
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;Initially running this command by hand, you should see something similar to the following:
</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;{Kerberos1}bash# /usr/Kerberos/sbin/kdb5_util dump /var/Kerberos/krb5kdc/slave_datatrans
{Kerberos1}bash# /usr/Kerberos/sbin/kprop -d -f /var/Kerberos/krb5kdc/slave_datatrans kerberos2.gnud.ie
3234 bytes sent.
Database propagation to kerberos2.gnud.ie: SUCCEEDED
{Kerberos1}bash#
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;The slave server will now synchronize its principal database with the master server.
</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="maintain"
></A
>5.3. Maintenance</H2
><P
>&#13;With these cron jobs in place principal propagation should be sufficiently automated as to require no maintenance.  At the time of a primary KDC failure, there is no need for human intervention unless the failure will last for an extended period of time.
</P
></DIV
></DIV
><DIV
CLASS="section"
><HR><H1
CLASS="section"
><A
NAME="client-configure"
></A
>6. Client Configuration</H1
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="client"
></A
>6.1. General GNU/Linux Client Configuration</H2
><P
>&#13;GNU/Linux distributions of Kerberos include a client package which contains all of the software and configuration files needed for setting up a GNU/Linux machine to be able to perform Kerberos authentications against a KDC. In Fedora derived GNU/Linux, this package is <EM
>krb5-workstation</EM
>.  In order for your system to be capable of Kerberos authentication, including by authentication by kerberized applications, you must configure Kerberos on the system.
</P
><P
>&#13;Configuration involves editing the <TT
CLASS="filename"
>/etc/krb5.conf</TT
> file.  In this file, you must specify your realm, KDC's, administrative server, logging, default domain, and KDC information. You must also modify the <TT
CLASS="filename"
>kdc.conf</TT
> file, which you are allowed to specify a location for in the <TT
CLASS="filename"
>krb5.conf</TT
> file.  The default location is <TT
CLASS="filename"
>/var/Kerberos/krb5kdc/kdc.conf</TT
>.  The <TT
CLASS="filename"
>kdc.conf</TT
> file contains information about the encryption algorithm policy of the realm.
</P
><P
>&#13;The configuration information for the system on which you wish to perform Kerberos authentications is the same information which was placed in the <TT
CLASS="filename"
>/etc/krb5.conf</TT
> filename on the KDC.  Here are example <TT
CLASS="filename"
><A
HREF="http://cryptnet.net/fdp/admin/kerby-infra/en/krb5.conf"
TARGET="_top"
>krb5.conf</A
></TT
> and
<TT
CLASS="filename"
><A
HREF="http://cryptnet.net/fdp/admin/kerby-infra/en/kdc.conf"
TARGET="_top"
>kdc.conf</A
></TT
> configuration files from a client for the Gnu University Dublin example.
</P
><P
>&#13;Now, you can test Kerberos authentication using the <SPAN
CLASS="application"
>kinit</SPAN
> command:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;bash$ kinit &#60;username&#62;
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;If your authentication fails, the best place to look for a description of the cause are the system log files on the client and the KDC log file on the KDC which authentication was performed against.  When trouble shooting authentication issues, it can be very helpful to have a terminal windows open to the KDC running a
<EM
>tail -f</EM
> on the KDC log. In our example <TT
CLASS="filename"
>krb5.conf</TT
>, the location of the
KDC log was <TT
CLASS="filename"
>/var/log/Kerberos/krb5kdc.log</TT
>.
</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="pam"
></A
>6.2. PAM</H2
><P
>&#13;PAM, or Pluggable Authentication Module, technology which is shipped with many distributions of GNU/Linux is capable of integration with Kerberos through the <SPAN
CLASS="application"
>pam_krb5</SPAN
> module. In order to use Kerberos authentication with PAM you must install the <SPAN
CLASS="application"
>pam_krb5</SPAN
> module and modify the pam configuration files.
</P
><P
>&#13;The <SPAN
CLASS="application"
>pam_krb5</SPAN
> module comes with sample configuration filenames which are located in <TT
CLASS="filename"
>/usr/share/doc/pam_krb5-1.55/pam.d</TT
>.  The basic change that these configuration files make to allow PAM controlled services to authenticate against Kerberos is similar to the following:
</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;auth       required     /lib/security/pam_krb5.so use_first_pass
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="apache"
></A
>6.3. Apache Web Server</H2
><P
>&#13;Kerberos can be used as an authentication mechanism for the Apache Web Server.  The <SPAN
CLASS="application"
>mod_auth_kerb</SPAN
>
application is an apache module which provides that functionality. Using that module, you will be able to set Kerberos as an authentication type for access control stanzas in the <TT
CLASS="filename"
>httpd.conf</TT
> file.  Be aware that while Kerberos is being used, this is a less than ideal authentication mechanism because tickets are stored on the web server rather than on the client machine.  However, if your goals is to implement a single sign-on solution or consolidate accounts, there is value here. <SPAN
CLASS="application"
>mod_auth_kerb</SPAN
> is capable of supporting Kerberos 4, however that is not covered in this howto because of the known weaknesses with version 4 of the protocol.
</P
><P
>&#13;The <SPAN
CLASS="application"
>mod_auth_kerb</SPAN
> website can be found at <A
HREF="http://modauthkerb.sourceforge.net/"
TARGET="_top"
>http://modauthkerb.sourceforge.net/</A
>. It is important to use the HTTPS protocol when accessing a site which uses <SPAN
CLASS="application"
>mod_auth_kerb</SPAN
>, since <SPAN
CLASS="application"
>mod_auth_kerb</SPAN
> uses the base auth mechanism.  Base auth uses base64 encoding which can easily be translated back to plaintext. Therefore it's important that the authentication exchange is SSL encrypted to ensure that the user name and password are protected when they are transmitted to the webserver.
</P
><P
>&#13;To compile apache with the <SPAN
CLASS="application"
>mod_auth_krb</SPAN
> module, you must take the following steps:
</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;bash$ export 'LIBS=-L/usr/Kerberos/lib -lkrb5 -lcrypto -lcom_err'
bash$ export 'CFLAGS=-DKRB5 -DKRB_DEF_REALM=\\\"GNUD.IE\\\"'
bash$ export 'INCLUDES=-I/usr/Kerberos/include'
bash$ mkdir apache_x.x.x/src/modules/kerberos
bash$ cp mod_auth_kerb-x.x.x.c apache_x.x.x/src/modules/kerberos
bash$ ./configure --prefix=/home/httpd --add-module=src/modules/Kerberos/mod_auth_kerb.c
bash$ make
bash$ make install
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
><P
>&#13;You should test apache to make sure that it works.  Once you have a known working copy of SSL enabled apache on the machine you can modify the <TT
CLASS="filename"
>httpd.conf</TT
> filename to provide Kerberos authentication for a directory:
</P
><P
>&#13;Here is an example stanza from the mod_auth_kerb apache modules which enables Kerberos 5 authentication for a directory:
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;&#60;Directory "/home/httpd/htdocs/content"&#62;
   AllowOverride None
   AuthType KerberosV5
   AuthName "Kerberos Login"
   KrbAuthRealm GNUD.IE
   require valid-user
&#60;/Directory&#62;
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="microsoft"
></A
>6.4. Microsoft Windows</H2
><P
>&#13;Due to a flawed implementation of the Kerberos standard by Microsoft, there is limited compatibility between standard MIT Kerberos and Microsoft's version.  Microsoft has published a document which describes the limited ways in which Microsoft's broken version of Kerberos is able to interoperate with standard Kerberos. That document is available
<A
HREF="http://www.microsoft.com/windows2000/techinfo/planning/security/kerbsteps.asp"
TARGET="_top"
>here</A
>.
</P
></DIV
></DIV
><DIV
CLASS="section"
><HR><H1
CLASS="section"
><A
NAME="programming"
></A
>7. Programming With Kerberos</H1
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="api"
></A
>7.1. The Kerberos API</H2
><P
>&#13;Kerberos development libraries will allow you to Kerberos enable, or kerberize, any application.  There are two primary libraries, a general usage Kerberos library used for basic authentication and a Kerberos administration library used to perform administrative functions such as operations on principals.  In Fedora derived GNU/Linux, the rpm <TT
CLASS="filename"
>krb5-devel</TT
> contains the development libraries and documentation. An API specification for these libraries can be found in the Kerberos documentation included with most Kerberos distributions. In Fedora derived GNU/Linux, it installs in: <TT
CLASS="filename"
>/usr/share/doc/krb5-devel-1.2.2/api</TT
>
</P
><P
>&#13;The documentation is in the LaTeX format.  In order to view it you must generate dvi filenames from it which can then be viewed with <SPAN
CLASS="application"
>xdiv</SPAN
>.  This can all be done with the following commands:
</P
><P
>&#13;<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;bash$ cd /usr/share/doc/krb5-devel-x.x.x/api/
bash$ su
bash# make
bash# (^d)
bash$ xdvi library.dvi
</PRE
></FONT
></TD
></TR
></TABLE
>
</P
></DIV
></DIV
><DIV
CLASS="appendix"
><HR><H1
CLASS="appendix"
><A
NAME="sources"
></A
>A. Relevant Sources for More Information</H1
><DIV
CLASS="section"
><H1
CLASS="section"
><A
NAME="links"
></A
>A.1. Links to related documents</H1
><P
></P
><UL
><LI
><P
>&#13;<A
HREF="http://web.mit.edu/kerberos/www/krb5-1.2/krb5-1.2.6/doc/install_toc.html"
TARGET="_top"
>Kerberos V5 Installation Guide</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://web.mit.edu/kerberos/www/krb5-1.2/krb5-1.2.6/doc/user-guide_toc.html"
TARGET="_top"
>Kerberos V5 UNIX User's Guide</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://web.mit.edu/kerberos/www/krb5-1.2/krb5-1.2.6/doc/admin_toc.html"
TARGET="_top"
>Kerberos V5 System Administrator's Guide</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://web.mit.edu/kerberos/www/krb5-1.2/krb5-1.2.6/doc/krb425_toc.html"
TARGET="_top"
>Upgrading to Kerberos V5 from Kerberos V4</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://www.nrl.navy.mil/CCS/people/kenh/kerberos-faq.html"
TARGET="_top"
>Kerberos FAQ</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://web.mit.edu/kerberos/www/dialogue.html"
TARGET="_top"
>Designing an Authentication System: a Dialog in Four Scenes</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://www.ornl.gov/~jar/HowToKerb.html"
TARGET="_top"
>How To Kerberize Your Site</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://www.isi.edu/gost/brian/security/kerberos.html"
TARGET="_top"
>The Moron's Guide to Kerberos</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://www.angelfire.com/hi/plutonic/afs-faq.html"
TARGET="_top"
>AFS FAQ</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://cryptnet.net/mirrors/docs/krb5api.html"
TARGET="_top"
>The Kerberos 5 API</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://cryptnet.net/mirrors/docs/krb5adm_api.html"
TARGET="_top"
>The Kerberos 5 Admin API</A
>
</P
></LI
></UL
></DIV
><DIV
CLASS="section"
><HR><H1
CLASS="section"
><A
NAME="websites"
></A
>A.2. Related web sites</H1
><P
></P
><UL
><LI
><P
>&#13;<A
HREF="http://web.mit.edu/kerberos/www/"
TARGET="_top"
>MIT Kerberos Website</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://www.ntp.org/"
TARGET="_top"
>The NTP Distribution Website</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://www.eecis.udel.edu/~mills/ntp/clock2b.html"
TARGET="_top"
>List of Public Stratum 2 NTP Servers</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://www.openafs.org/"
TARGET="_top"
>OpenAFS Website</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://www.pdc.kth.se/heimdal/"
TARGET="_top"
>Heimdal Kerberos Website</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://www.crypto-publish.org/"
TARGET="_top"
>The Crypto Publishing Project</A
> (Unrestricted source for Kerberos source code)
</P
></LI
><LI
><P
>&#13;<A
HREF="http://www.cosic.esat.kuleuven.ac.be/sesame/"
TARGET="_top"
>SESAME</A
> (Secure European System for Applications in a Multi-vendor Environment)
</P
></LI
></UL
></DIV
><DIV
CLASS="section"
><HR><H1
CLASS="section"
><A
NAME="rfc"
></A
>A.3. Related RFCs</H1
><P
></P
><UL
><LI
><P
>&#13;<A
HREF="http://cryptnet.net/mirrors/rfcs/rfc2744.txt"
TARGET="_top"
>RFC2744: Generic Security Service API Version 2: C-bindings</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://cryptnet.net/mirrors/rfcs/rfc2743.txt"
TARGET="_top"
>RFC2743: Generic Security Service Application Program Interface, Version 2 Update 1</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://cryptnet.net/mirrors/rfcs/rfc2712.txt"
TARGET="_top"
>RFC2712: Addition of Kerberos Cipher Suites to Transport Layer Security (TLS)</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://cryptnet.net/mirrors/rfcs/rfc2078.txt"
TARGET="_top"
>RFC2078: Generic Security Service Application Program Interface, Version 2</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://cryptnet.net/mirrors/rfcs/rfc1964.txt"
TARGET="_top"
>RFC1964: The Kerberos Version 5 GSS-API Mechanism</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://cryptnet.net/mirrors/rfcs/rfc1510.txt"
TARGET="_top"
>RFC1510: The Kerberos Network Authentication Service (V5)</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://cryptnet.net/mirrors/rfcs/rfc1509.txt"
TARGET="_top"
>RFC1509: Generic Security Service API : C-bindings</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://cryptnet.net/mirrors/rfcs/rfc1508.txt"
TARGET="_top"
>RFC1508: Generic Security Service Application Program Interface</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://cryptnet.net/mirrors/rfcs/rfc1411.txt"
TARGET="_top"
>RFC1411: Telnet Authentication: Kerberos Version 4</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://cryptnet.net/mirrors/rfcs/rfc1305.txt"
TARGET="_top"
>RFC1305: Network Time Protocol (Version 3) Specification, Implementation and Analysis</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://cryptnet.net/mirrors/rfcs/rfc1119.txt"
TARGET="_top"
>RFC1119: Network Time Protocol (Version 2) Specification and Implementation</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://cryptnet.net/mirrors/rfcs/rfc1059.txt"
TARGET="_top"
>RFC1059: Network Time Protocol (Version 1) Specification and Implementation</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://cryptnet.net/mirrors/rfcs/rfc958.txt"
TARGET="_top"
>RFC958: Network Time Protocol (NTP)</A
>
</P
></LI
></UL
></DIV
><DIV
CLASS="section"
><HR><H1
CLASS="section"
><A
NAME="other-ref"
></A
>A.4. Other references</H1
><P
></P
><UL
><LI
><P
>&#13;[<SPAN
CLASS="citation"
>Applied Cryptography</SPAN
>] Second Edition, Bruce Schneier [<A
HREF="http://www.amazon.com/exec/obidos/tg/detail/-/0471117099/qid%3D1085516723/sr%3D11-1/ref%3Dsr%5F11%5F1/103-3431487-6727030?v=glance"
TARGET="_top"
>ISBN: 0-471-11709-9</A
>]
</P
></LI
></UL
></DIV
><DIV
CLASS="section"
><HR><H1
CLASS="section"
><A
NAME="resources"
></A
>A.5. Additional resources</H1
><P
></P
><UL
><LI
><P
>&#13;<A
HREF="http://mailman.mit.edu/mailman/listinfo/kerberos"
TARGET="_top"
>The Kerberos Authentication System Mailing List</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://mailman.mit.edu/pipermail/kerberos/"
TARGET="_top"
>The Kerberos Authentication System Mailing List Archives</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="news:comp.protocols.kerberos"
TARGET="_top"
>comp.protocols.kerberos</A
> UseNet Newsgroup
</P
></LI
></UL
></DIV
><DIV
CLASS="section"
><HR><H1
CLASS="section"
><A
NAME="companies"
></A
>A.6. Companies which provide specialist Kerberos consulting</H1
><P
></P
><UL
><LI
><P
>&#13;<A
HREF="http://www.cybersafe.ltd.uk/"
TARGET="_top"
>Cybersafe, Ltd.</A
>
</P
></LI
><LI
><P
>&#13;<A
HREF="http://www.e-techservices.com/solutions/kerberos/"
TARGET="_top"
>e-TechServices.com, Inc.</A
> IBM Business Partner
</P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="GLOSSARY"
><H1
><A
NAME="AEN477"
></A
>Glossary of Terms</H1
><DL
><DT
><B
>ASN.1</B
></DT
><DD
><P
>&#13;Abstract Syntax Notation One. ASN.1 is a notation used describe messages. It describes them as a sequence of components. The described components may be sequences also. ASN.1 is used to describe the internals of Kerberos datagrams. Unless you are a software developer, you do not need to gain an understanding of ASN.1.
</P
></DD
><DT
><B
>Authenticator</B
></DT
><DD
><P
>&#13;A record containing information that can be shown to have been recently generated using the session key known only by the client and server. (Definition taken from <A
HREF="http://cryptnet.net/mirrors/rfcs/rfc1510.txt"
TARGET="_top"
>RFC1510</A
>)
</P
></DD
><DT
><B
>Credentials</B
></DT
><DD
><P
>&#13;A ticket for the server and a session key which is used to authenticate the principal.
</P
></DD
><DT
><B
>Cross-Realm Authentication</B
></DT
><DD
><P
>&#13;Kerberos has the ability for a KDC is one realm to authenticate a principal in another realm if a secret is shared between the KDCs of both realms.  This inter-realm authentication is called cross-realm authentication.
</P
></DD
><DT
><B
>Data Encryption Standard [DES]</B
></DT
><DD
><P
>&#13;An algorithm used for encrypted which was the official algorithm of the United Sates Government.  It was developed by IBM with assistance from the NSA. The algorithm is a sixteen round block cipher which uses a 64bit block and a 56bit key.
</P
></DD
><DT
><B
>Forwardable Ticket</B
></DT
><DD
><P
>&#13;A ticket granted by the KDC which allows the user to request additional tickets with different IP addresses.  In effect, a TGT which allows the authenticated principal to request tickets valid on other additional machines.
</P
></DD
><DT
><B
>Generic Security Services Application Programming Interface [GSS-API]</B
></DT
><DD
><P
>&#13;A set of C language bindings which provide security services to its callers.  The API may be implemented on top of various
cryptographic systems.  Kerberos is one example of such a system.
</P
></DD
><DT
><B
>Key Distribution Center [KDC]</B
></DT
><DD
><P
>&#13;The machine and software which perform the role of the trusted arbitrator in the Kerberos protocol.
</P
></DD
><DT
><B
>Kerberos</B
></DT
><DD
><P
>&#13;An authentication protocol in which a trusted third party, an arbitrator, is relied upon to perform the authentication of clients on a TCP/IP network.  The protocol was designed in a way that encrypted tickets are transmitted over the network rather than traditional plaintext passwords providing for secure network authentication.
</P
></DD
><DT
><B
>Kerberize</B
></DT
><DD
><P
>&#13;(v.) The act of modifying a system, service, or piece of software to make use of the Kerberos protocol to perform authentication. (adj. kerberized) A system, service, or piece of software which supports authentication through Kerberos.
</P
></DD
><DT
><B
>Network Time Protocol [NTP]</B
></DT
><DD
><P
>&#13;A protocol used to synchronizes clocks of hosts and routers on the Internet.
</P
></DD
><DT
><B
>Postdatable ticket</B
></DT
><DD
><P
>&#13;In Kerberos 5, a ticket which is invalid initially and which becomes valid at some time in the future.  Normal Kerberos tickets are only valid from the time they are requested until the time that they expire.
</P
></DD
><DT
><B
>Preauthentication</B
></DT
><DD
><P
>&#13;Additional authentication which takes place before a KDC grants a TGT to a principal.  An example of such authentication may be the satisfaction of a biometrics system.
</P
></DD
><DT
><B
>Principal</B
></DT
><DD
><P
>&#13;A user or server for which a secret key is stored in the KDC database.
</P
></DD
><DT
><B
>Proxiable Ticket</B
></DT
><DD
><P
>&#13;In Kerberos 5, a ticket which allows you to request a TGT for alternative IP addresses.
</P
></DD
><DT
><B
>Realm</B
></DT
><DD
><P
>&#13;The scope of a Kerberos deployment.  Specifically, the organization domain for which the KDC is trusted to authenticate principals.
</P
></DD
><DT
><B
>Renewable Ticket</B
></DT
><DD
><P
>&#13;In Kerberos 5, a ticket which allows the principal a maximum renewable lifetime in addition to the standard ticket lifetime.  Renewable tickets may be used to acquire additional tickets from the KDC as long as the ticket is valid.  Renewed tickets can be requested up to the maximum renewable lifetime of the original renewable ticket.
</P
></DD
><DT
><B
>Salt</B
></DT
><DD
><P
>&#13;A seed value used in the encryption of a plaintext password to expand the number of possible resulting ciphertexts from a given plaintext. The use of a salt value is a defensive measure used to protect encrypted passwords against dictionary attacks.
</P
></DD
><DT
><B
>Stash File</B
></DT
><DD
><P
>&#13;A disk store of secret keys.
</P
></DD
><DT
><B
>Ticket</B
></DT
><DD
><P
>&#13;A data message consiting of the client's identity, a session key, a timestamp, and other information all encrypted with the server's secret key. It is used to perform authentication.
</P
></DD
><DT
><B
>Ticket Granting Service [TGS]</B
></DT
><DD
><P
>&#13;A service which is capable and authorized in the issuing of tickets to clients after they have acquire a Ticket Granting Ticket (TGT).
</P
></DD
><DT
><B
>Ticket Granting Ticket [TGT]</B
></DT
><DD
><P
>&#13;A ticket which contains a session key to be used in communication between the client and the KDC.
</P
></DD
><DT
><B
>Transitive Cross-Realm Authentication</B
></DT
><DD
><P
>&#13;In Kerberos 5, the ability to chain trust together between realms building in effect a trust path so that a principal in realm X that wishes to authenticate a principal in realm Z does not need the KDC for realm X to share a secret with realm Z if both realm X and realm Z share a secret with realm Y. Realm Y can be used as a "hop" in a trust path.
</P
></DD
><DT
><B
>Triple DES</B
></DT
><DD
><P
>&#13;A variant of DES in which data is encrypted three times with standard DES using two different keys.
</P
></DD
></DL
></DIV
></DIV
></BODY
></HTML
>