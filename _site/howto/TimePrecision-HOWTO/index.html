<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML
><HEAD
><TITLE
>Managing Accurate Date and Time</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><link rel="stylesheet" href="../bookstyle.css"></HEAD
><BODY
CLASS="article"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="title"
><A
NAME="AEN2"
></A
>Managing Accurate Date and Time</H1
><DIV
CLASS="authorgroup"
><A
NAME="AEN7"
></A
><H3
CLASS="author"
><A
NAME="AEN8"
>Avi Alkalay</A
></H3
><P
CLASS="othercredit"
><B
>Brad Knowles - </B
><SPAN
CLASS="contrib"
>Suggestion to use pool.ntp.org and NTP's stratum 2 public time servers</SPAN
></P
><P
CLASS="othercredit"
><B
>Kent Borg - </B
><SPAN
CLASS="contrib"
>Suggestion to use ntpq instead of ntpdc</SPAN
></P
><P
CLASS="othercredit"
><B
>Yura Moron - </B
><SPAN
CLASS="contrib"
>Good explanations on ntpq and ntpdc info</SPAN
></P
><P
CLASS="othercredit"
><B
>Takeo Nakano - </B
></P
><P
CLASS="othercredit"
><B
>SHAKI - </B
></P
><P
CLASS="othercredit"
><B
>Mihaly Gyulai - </B
></P
><P
CLASS="othercredit"
><B
>Philippe Wautelet - </B
></P
><P
CLASS="othercredit"
><B
>Kemal √ñkmen - </B
></P
></DIV
><P
CLASS="copyright"
>Copyright &copy; 2002,2003,2004,2005 Avi Alkalay</P
><P
CLASS="pubdate"
>2005-11-18<BR></P
><DIV
CLASS="revhistory"
><TABLE
WIDTH="100%"
BORDER="0"
><TR
><TH
ALIGN="LEFT"
VALIGN="TOP"
COLSPAN="3"
><B
>Revision History</B
></TH
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 2005-11-18</TD
><TD
ALIGN="LEFT"
>18 Nov 2005</TD
><TD
ALIGN="LEFT"
>Revised by: Avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Included link to turkish translation</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 2005-10-12</TD
><TD
ALIGN="LEFT"
>12 Oct 2005</TD
><TD
ALIGN="LEFT"
>Revised by: Avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>The Brazil zic file is now external and updated</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 2005-05-03</TD
><TD
ALIGN="LEFT"
>03 May 2005</TD
><TD
ALIGN="LEFT"
>Revised by: Avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Included link to french translation</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 1.0.8</TD
><TD
ALIGN="LEFT"
>2004-10-29</TD
><TD
ALIGN="LEFT"
>Revised by: Mihaly Gyulai</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Hungarian translation, the chorny section and the very first section</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 1.0.7</TD
><TD
ALIGN="LEFT"
>9 Jul 2004</TD
><TD
ALIGN="LEFT"
>Revised by: avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Disclaimer near to license, to let people know they can translate without asking permission.Small fixes in some phrases.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 1.0.6</TD
><TD
ALIGN="LEFT"
>25 Feb 2004</TD
><TD
ALIGN="LEFT"
>Revised by: avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Included credits and link to russian translation.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 1.0.5</TD
><TD
ALIGN="LEFT"
>05 Jul 2003</TD
><TD
ALIGN="LEFT"
>Revised by: avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Changed public time servers list URL. Added pool.ntp.org.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 1.0.4</TD
><TD
ALIGN="LEFT"
>21 Dec 2002</TD
><TD
ALIGN="LEFT"
>Revised by: avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Added japanese translation link and credits.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 1.0.3</TD
><TD
ALIGN="LEFT"
>24 Aug 2002</TD
><TD
ALIGN="LEFT"
>Revised by: avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Fixed wrong screen and programlisting widths.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 1.0.2</TD
><TD
ALIGN="LEFT"
>04 Aug 2002</TD
><TD
ALIGN="LEFT"
>Revised by: avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Link to public time servers page.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 1.0.1</TD
><TD
ALIGN="LEFT"
>07 May 2002</TD
><TD
ALIGN="LEFT"
>Revised by: avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Final XML conversion. Files reorganization.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 1.0</TD
><TD
ALIGN="LEFT"
>28 Apr 2002</TD
><TD
ALIGN="LEFT"
>Revised by: avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Finalized image.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 0.8</TD
><TD
ALIGN="LEFT"
>27 Apr 2002</TD
><TD
ALIGN="LEFT"
>Revised by: avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Switched from ntpdc example to ntpq, based on contributions.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 0.8.1</TD
><TD
ALIGN="LEFT"
>20 Apr 2002</TD
><TD
ALIGN="LEFT"
>Revised by: avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Improved graphic. Links to other doc locations.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 0.8</TD
><TD
ALIGN="LEFT"
>14 Apr 2002</TD
><TD
ALIGN="LEFT"
>Revised by: avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Beter tunning of NTP graphic.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 0.76</TD
><TD
ALIGN="LEFT"
>13 Apr 2002</TD
><TD
ALIGN="LEFT"
>Revised by: avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Inclusion of architecture graphic.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 0.75</TD
><TD
ALIGN="LEFT"
>10 Apr 2002</TD
><TD
ALIGN="LEFT"
>Revised by: avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Spell checked. Using DocBook XSLT 1.50.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 0.65</TD
><TD
ALIGN="LEFT"
>31 Mar 2002</TD
><TD
ALIGN="LEFT"
>Revised by: avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Upgraded to XML 4.1.2 DocBook format</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 0.6</TD
><TD
ALIGN="LEFT"
>29 Mar 2002</TD
><TD
ALIGN="LEFT"
>Revised by: avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Finished timezone mechanism on Linux. Created appendix. Now only drawings are needed.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 0.4</TD
><TD
ALIGN="LEFT"
>24 Mar 2002</TD
><TD
ALIGN="LEFT"
>Revised by: avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>All skeleton defined. All command examples written.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Revision 0.2</TD
><TD
ALIGN="LEFT"
>19 Mar 2002</TD
><TD
ALIGN="LEFT"
>Revised by: avi</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>First DocBook version</TD
></TR
></TABLE
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
>1. <A
HREF="#why"
>Why do We Need a Precise Clock?</A
></DT
><DD
><DL
><DT
>1.1. <A
HREF="#why.pcclock"
>On What Factors Does the Hardware-Clock Depend?</A
></DT
></DL
></DD
><DT
>2. <A
HREF="#time"
>Computer Global Date and Time Concept</A
></DT
><DT
>3. <A
HREF="#tz"
>What are Time Zones?</A
></DT
><DD
><DL
><DT
>3.1. <A
HREF="#tz.dst"
>Daylight Savings Time</A
></DT
><DT
>3.2. <A
HREF="#tz.examples"
>Time Zones Examples</A
></DT
><DT
>3.3. <A
HREF="#tz.linux"
>Time Zone Mechanism on Linux</A
></DT
></DL
></DD
><DT
>4. <A
HREF="#set"
>The Correct Settings for Your Linux Box</A
></DT
><DD
><DL
><DT
>4.1. <A
HREF="#set.tz"
>Setting Time Zone</A
></DT
><DT
>4.2. <A
HREF="#set.hwclock"
>Setting the Hardware Clock</A
></DT
></DL
></DD
><DT
>5. <A
HREF="#ntp"
>Accurate Global Time Synchronization</A
></DT
><DD
><DL
><DT
>5.1. <A
HREF="#ntp.ntp"
><SPAN
CLASS="acronym"
>NTP</SPAN
>: The Network Time Protocol</A
></DT
><DT
>5.2. <A
HREF="#ntp.arch"
>Building a Simple Time Synchronization Architecture</A
></DT
><DT
>5.3. <A
HREF="#ntp.configs"
><SPAN
CLASS="acronym"
>NTP</SPAN
> Configurations</A
></DT
><DT
>5.4. <A
HREF="#ntp.watch"
>Watching Your Box Synchronizing</A
></DT
><DT
>5.5. <A
HREF="#ntp.boot"
>Configure to Automatically Run <SPAN
CLASS="acronym"
>NTP</SPAN
> at Boot</A
></DT
></DL
></DD
><DT
>6. <A
HREF="#ntp.chrony"
>Precise Time with the <B
CLASS="command"
>chrony</B
> Program</A
></DT
><DD
><DL
><DT
>6.1. <A
HREF="#ntp.chrony.diff"
>How <B
CLASS="command"
>chrony</B
> Differs from the <B
CLASS="command"
>ntp</B
> Suite?</A
></DT
><DT
>6.2. <A
HREF="#ntp.chrony.how"
>How to Use <B
CLASS="command"
>chrony</B
>?</A
></DT
></DL
></DD
><DT
>A. <A
HREF="#about"
>About this Document</A
></DT
></DL
></DIV
><DIV
CLASS="section"
><H1
CLASS="section"
><A
NAME="why"
></A
>1. Why do We Need a Precise Clock?</H1
><P
>If our computer never connects to other computers (or other devices that use a clock), the precision of the clock is not critical itself, it depends on the need of the user. However, programs that some way use the net are dependent on a precise date and time. Some examples, when you may need precise clock:</P
><P
></P
><UL
><LI
><P
>Softwares that deal with transactions</P
></LI
><LI
><P
>Commercial applications (e.g. eBay)</P
></LI
><LI
><P
>Mail and messaging-related client and servers</P
></LI
><LI
><P
>Websites that use cookies</P
></LI
><LI
><P
>Distributed web applications</P
></LI
><LI
><P
>Web services</P
></LI
><LI
><P
>Distributed component-based applications as <SPAN
CLASS="acronym"
>J2EE</SPAN
>, <SPAN
CLASS="acronym"
>.NET</SPAN
>, etc</P
></LI
><LI
><P
>Advanced modern and paralel filesystems, as AFS, DFS, GFS, GPFS, etc</P
></LI
></UL
><P
>And of course, to use the computer to adjust our wristwatch clock.</P
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="why.pcclock"
></A
>1.1. On What Factors Does the Hardware-Clock Depend?</H2
><P
>Here we talk a little about the hardware-clock precision.</P
><P
>In PCs we find quartz-oscillators maintaining the hardware clock. The frequency of the oscillator is divided, and at the end we get a counter stepping once in one second (in reality it is more complicated, but now it's enough for us). The clock-oscillator runs even if the computer is switched off, so after starting the computer (and starting Linux) the hardware clock can give the values of the actual time. The stability of this clock is mostly dependent on the temperature of its surroundings, but it is also dependent on the air-pressure and the stability of the power supply voltage. The hardware clock is inaccurate in short term, however in the long term it shows a certain difference from the exact time. As we continously can compare the frequency of our hardware clock and an exact clock, we can calculate the frequency of the hardware clock and so to create the exact time. If this exact clock is inside your LAN (local area network), the accuracy of your Linux machine clock is within 0.01 sec. If you use the internet for this purpose, the accuracy of your clock will be within 0.2 sec regarding to the exact time.</P
></DIV
></DIV
><DIV
CLASS="section"
><HR><H1
CLASS="section"
><A
NAME="time"
></A
>2. Computer Global Date and Time Concept</H1
><P
>To determine the current time for some planet region, a computer needs exactly this two informations:</P
><P
></P
><OL
TYPE="1"
><LI
><P
>Correct <SPAN
CLASS="acronym"
>UTC</SPAN
> (universal time as in Greenwich, but not <SPAN
CLASS="acronym"
>GMT</SPAN
>) time</P
></LI
><LI
><P
>Region's current Time Zone</P
></LI
></OL
><P
>For computers, there is also the hardware clock, which is used as a base by the OS to set its time.</P
><P
>OS date and time (we'll use only date <EM
>or</EM
> time from now on) is set on boot, by some script that reads the hardware clock, makes Time Zone calculations (there is no time zone data stored in <SPAN
CLASS="acronym"
>BIOS</SPAN
>) and sets the OS. After this synchronization, <SPAN
CLASS="acronym"
>BIOS</SPAN
> and OS time are independent from each other. So after a while they may have some seconds of difference. Which one is correct? If you don't make special configurations, none of them.</P
><P
>We'll discuss here how to make them both <EM
>globally 100% accurate</EM
>.</P
></DIV
><DIV
CLASS="section"
><HR><H1
CLASS="section"
><A
NAME="tz"
></A
>3. What are Time Zones?</H1
><P
>Time Zones are a geographical world globe division of 15<SUP
>o</SUP
> each, starting at Greenwich, in England, created to help people know what time is it now in another part of the world.</P
><P
>Nowadays it is much more a political division than geographical, because sometimes people needs to have the same time as other people in not-so-far locations. And for energy savings reasons, we have today the <A
HREF="#tz.dst"
>Daylight Savings Time</A
>, that are also a Time Zone variation.</P
><P
>Time Zones are usually defined by your country government or some astronomical institute, and is represented by 3 or 4 letters. See <A
HREF="#tz.examples"
>Section 3.2</A
> for examples.</P
><P
>Use the <A
HREF="http://www.timezoneconverter.com/"
TARGET="_top"
>timezoneconverter.com</A
> to know what time is it now at any part of the globe.</P
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="tz.dst"
></A
>3.1. Daylight Savings Time</H2
><P
>For energy savings reasons, governments created the Daylight Savings Time. Our clocks are forwarded one hour, and this makes our days look longer. In fact, what really happens is only a Time Zone change. The primitive time (<SPAN
CLASS="acronym"
>UTC</SPAN
>) is still, and will allways be, the same.</P
><P
>Later we'll see how to enable and disable <SPAN
CLASS="acronym"
>DST</SPAN
> automatically in Linux.</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="tz.examples"
></A
>3.2. Time Zones Examples</H2
><P
>There is nothing better than examples:</P
><DIV
CLASS="table"
><A
NAME="tz.ex.br"
></A
><P
><B
>Table 1. Brazilian Time Zones. Shifts relative to <SPAN
CLASS="acronym"
>UTC</SPAN
></B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><THEAD
><TR
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
>Name and Shift</TH
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
><A
HREF="#tz.dst"
><SPAN
CLASS="acronym"
>DST</SPAN
></A
> Name and Shift</TH
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
>Locations</TH
></TR
></THEAD
><TBODY
><TR
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>BREST -2:00</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>BREDT -1:00</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>Fernando de Noronha</TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>BRST -3:00</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>BRDT -2:00</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>S„o Paulo, Rio, Brasilia, Minas Gerais, North East Region, South Region,etc</TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>BRWST -4:00</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>BRWDT -3:00</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>West Region</TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>BRAST -5:00</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>BRADT -4:00</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>Acre</TD
></TR
></TBODY
></TABLE
></DIV
><P
>Please send me contributions like this table for US Time Zones.</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="tz.linux"
></A
>3.3. Time Zone Mechanism on Linux</H2
><P
>Linux systems uses the GLIBC dynamic Time Zones, based on <TT
CLASS="filename"
>/etc/localtime</TT
>. This file is a link to (or a copy of) a zone information file, usually located under <TT
CLASS="filename"
>/usr/share/zoneinfo</TT
> directory.</P
><P
>From a geophysical perspective, there is only 360<SUP
>o</SUP
>/15<SUP
>o</SUP
>=24 Time Zones in the world. But to make things easy to people, and to accommodate all the political variations (like Daylight Savings Time), you'll find hundreds of zoneinfo files in <TT
CLASS="filename"
>/usr/share/zoneinfo</TT
>, each for every world city, country, etc.</P
><P
>Some countries, like Brazil, don't have a fixed day to start Daylight Savings Time. It is defined every year, a couple of months before summer, and you may end up in a situation you'll have to change your zoneinfo file, which was compiled by <B
CLASS="command"
>zic</B
> from a text file like this.</P
><DIV
CLASS="example"
><A
NAME="AEN271"
></A
><P
><B
>Example 1. Brazilian Zone Info text file</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
>&#13;# Brazil Time Zones
#
# Brazilian Time Zones are:
# BREST: East of Brasilia. Fernando de Noronha.
# BRST:  Brasilia, S√£o Paulo, Rio, Northeast, South etc
# BRWST: West of Brasilia. Mato Grosso, Manaus
# BRAST: Acre.
#
# In daylight saving time, letter 'S' changes to 'D'.
# All the brazilian daylight changes can be found here:
#   http://pcdsh01.on.br/
#   http://pcdsh01.on.br/verao1.html
#
# To install, make:
#
# # zic Brazil.txt
#
# Zone files will be installed in /usr/share/zoneinfo (depends on your
# distribution). Then, make a symbolic link from your zone to /etc/localtime:
#
# # cd /etc; ln -sf /usr/share/zoneinfo/Brazil/Brasilia localtime
#
#
# If you have updates and new standards to this file please send to
# Avi Alkalay (avi @ unix.sh)
# Fred Neves (fneves @ registro.br)
#
# Last update: 12 Oct 2005
#
#
# This file is available at
#
# http://avi.alkalay.net/software/zoneinfo/
#

# Rule  NAME    FROM    TO      TYPE    IN    ON      AT      SAVE    LETTER/S
Rule    Brazil  1931    1932    -       Oct    3      00:00   1:00    D
Rule    Brazil  1932    1933    -       Mar   31      00:00   0       S
Rule    Brazil  1949    only    -       Dec    1      00:00   1:00    D
Rule    Brazil  1950    only    -       Apr   30      00:00   0       S
Rule    Brazil  1950    1952    -       Dec    1      00:00   1:00    D
Rule    Brazil  1951    only    -       Apr   16      00:00   0       S
Rule    Brazil  1952    only    -       Mar   31      00:00   0       S
Rule    Brazil  1953    only    -       Feb   28      00:00   0       S
Rule    Brazil  1963    only    -       Oct   23      00:00   1:00    D
Rule    Brazil  1964    only    -       Mar    1      00:00   0       S
Rule    Brazil  1965    only    -       Jan   31      00:00   1:00    D
Rule    Brazil  1965    only    -       Mar   31      00:00   0       S
Rule    Brazil  1965    only    -       Dec    1      00:00   1:00    D
Rule    Brazil  1966    1968    -       Mar    1      00:00   0       S
Rule    Brazil  1966    1967    -       Nov    1      00:00   1:00    D
Rule    Brazil  1984    only    -       Nov    2      00:00   1:00    D
Rule    Brazil  1985    only    -       Mar   15      00:00   0       S
Rule    Brazil  1985    only    -       Nov    2      00:00   1:00    D
Rule    Brazil  1986    only    -       Mar   15      00:00   0       S
Rule    Brazil  1986    only    -       Oct   25      00:00   1:00    D
Rule    Brazil  1987    only    -       Feb   14      00:00   0       S
Rule    Brazil  1987    only    -       Oct   25      00:00   1:00    D
Rule    Brazil  1988    only    -       Feb    7      00:00   0       S
Rule    Brazil  1988    only    -       Oct   16      00:00   1:00    D
Rule    Brazil  1989    only    -       Jan   29      00:00   0       S
Rule    Brazil  1989    only    -       Oct   15      00:00   1:00    D
Rule    Brazil  1990    only    -       Feb   11      00:00   0       S
Rule    Brazil  1990    only    -       Oct   21      00:00   1:00    D
Rule    Brazil  1991    only    -       Feb   17      00:00   0       S
Rule    Brazil  1991    only    -       Oct   20      00:00   1:00    D
Rule    Brazil  1992    only    -       Feb    9      00:00   0       S
Rule    Brazil  1992    only    -       Oct   25      00:00   1:00    D
Rule    Brazil  1993    only    -       Jan   31      00:00   0       S
Rule    Brazil  1993    only    -       Oct   17      00:00   1:00    D
Rule    Brazil  1994    only    -       Feb   20      00:00   0       S
Rule    Brazil  1994    only    -       Oct   16      00:00   1:00    D
Rule    Brazil  1995    only    -       Feb   19      00:00   0       S
Rule    Brazil  1995    only    -       Oct   15      00:00   1:00    D
Rule    Brazil  1996    only    -       Feb   11      00:00   0       S
Rule    Brazil  1996    only    -       Oct   06      00:00   1:00    D
Rule    Brazil  1997    only    -       Feb   16      00:00   0       S
Rule    Brazil  1997    only    -       Oct   06      00:00   1:00    D
Rule    Brazil  1998    only    -       Mar   01      00:00   0       S
Rule    Brazil  1998    only    -       Oct   11      00:00   1:00    D
Rule    Brazil  1999    only    -       Feb   21      00:00   0       S
Rule    Brazil  1999    only    -       Oct    3      00:00   1:00    D
Rule    Brazil  2000    only    -       Feb   27      00:00   0       S
Rule    Brazil  2000    only    -       Oct    8      00:00   1:00    D
Rule    Brazil  2001    only    -       Feb   18      00:00   0       S
Rule    Brazil  2001    only    -       Oct   14      00:00   1:00    D
Rule    Brazil  2002    only    -       Feb   17      00:00   0       S
Rule    Brazil  2002    only    -       Nov    3      00:00   1:00    D
Rule    Brazil  2003    only    -       Feb   16      00:00   0       S
Rule    Brazil  2003    only    -       Oct   19      00:00   1       D
Rule    Brazil  2004    only    -       Feb   15      00:00   0       S
Rule    Brazil  2004    only    -       Nov    2      00:00   1       D
Rule    Brazil  2005    only    -       Feb   20      00:00   0       S
Rule    Brazil  2005    only    -       Oct   16      00:00   1       D
Rule    Brazil  2006    only    -       Feb   19      00:00   0       S



# Zone  NAME                           GMTOFF  RULES/SAVE    FORMAT  [UNTIL]
Zone    Brazil/DeNoronha               -2:00   Brazil        BRE%sT
Zone    posix/Brazil/DeNoronha         -2:00   Brazil        BRE%sT
Zone    right/Brazil/DeNoronha         -2:00   Brazil        BRE%sT

Zone    America/Sao_Paulo              -3:00   Brazil        BR%sT
Zone    America/Rio_de_Janeiro         -3:00   Brazil        BR%sT
Zone    America/Brasilia               -3:00   Brazil        BR%sT
Zone    posix/America/Sao_Paulo        -3:00   Brazil        BR%sT
Zone    posix/America/Rio_de_Janeiro   -3:00   Brazil        BR%sT
Zone    posix/America/Salvador         -3:00   Brazil        BR%sT
Zone    posix/America/Brasilia         -3:00   Brazil        BR%sT
Zone    posix/Brazil/Central           -3:00   Brazil        BR%sT
Zone    posix/Brazil/Brasilia          -3:00   Brazil        BR%sT
Zone    posix/Brazil/Sao_Paulo         -3:00   Brazil        BR%sT
Zone    posix/Brazil/Salvador          -3:00   Brazil        BR%sT
Zone    posix/Brazil/Rio_de_Janeiro    -3:00   Brazil        BR%sT
Zone    right/America/Sao_Paulo        -3:00   Brazil        BR%sT
Zone    right/America/Rio_de_Janeiro   -3:00   Brazil        BR%sT
Zone    right/America/Salvador         -3:00   Brazil        BR%sT
Zone    right/America/Brasilia         -3:00   Brazil        BR%sT
Zone    right/Brazil/Central           -3:00   Brazil        BR%sT
Zone    right/Brazil/Brasilia          -3:00   Brazil        BR%sT
Zone    right/Brazil/Sao_Paulo         -3:00   Brazil        BR%sT
Zone    right/Brazil/Salvador          -3:00   Brazil        BR%sT
Zone    right/Brazil/Rio_de_Janeiro    -3:00   Brazil        BR%sT
Zone    Brazil/Central                 -3:00   Brazil        BR%sT
Zone    Brazil/Brasilia                -3:00   Brazil        BR%sT
Zone    Brazil/Sao_Paulo               -3:00   Brazil        BR%sT
Zone    Brazil/Rio_de_Janeiro          -3:00   Brazil        BR%sT
Zone    Brazil/Salvador                -3:00   Brazil        BR%sT
Zone    Brazil/East                    -3:00   Brazil        BR%sT
Zone    posix/Brazil/East              -3:00   Brazil        BR%sT
Zone    right/Brazil/East              -3:00   Brazil        BR%sT

Zone    Brazil/West                    -4:00   Brazil        BRW%sT
Zone    Brazil/Manaus                  -4:00   Brazil        BRW%sT
Zone    Brazil/Rondonia                -4:00   Brazil        BRW%sT
Zone    Brazil/Roraima                 -4:00   Brazil        BRW%sT
Zone    Brazil/Mato_Grosso             -4:00   Brazil        BRW%sT
Zone    posix/Brazil/Manaus            -4:00   Brazil        BRW%sT
Zone    posix/Brazil/Mato_Grosso       -4:00   Brazil        BRW%sT
Zone    right/Brazil/Manaus            -4:00   Brazil        BRW%sT
Zone    right/Brazil/Mato_Grosso       -4:00   Brazil        BRW%sT
Zone    posix/America/Manaus           -4:00   Brazil        BRW%sT
Zone    right/America/Manaus           -4:00   Brazil        BRW%sT

Zone    Brazil/Acre                    -5:00   Brazil        BRA%sT

				</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>The <B
CLASS="command"
>Rule</B
> block defines the date and time we change the Time Zone, while in the <B
CLASS="command"
>Zone</B
> block we reference the <B
CLASS="command"
>Rule</B
> will manage it. Note that the <B
CLASS="command"
>Zone</B
> name is actually the file name under <TT
CLASS="filename"
>/usr/share/zoneinfo</TT
> directory, and here we defined several different names for the same Time Zone, just to be easyer for people to find their zone.</P
><P
>This file's comments explains how to install these time zones, using the <B
CLASS="command"
>zic</B
> zoneinfo compiler (which already installs them also). To make it effective, you only have to link (or copy) the zoneinfo file to <TT
CLASS="filename"
>/etc/localtime</TT
>. In some distributions, there is a higher level (and preferred) way to set the Time Zone, described in <A
HREF="#set.tz"
>Section 4.1</A
>.</P
><P
>After making <TT
CLASS="filename"
>/etc/localtime</TT
> pointing to the correct zoneinfo file, you are already under that zone rules and <SPAN
CLASS="acronym"
>DST</SPAN
> changes are automatic -- you don't have to change time manually.</P
><P
>The following command sequence shows Linux Time Zone mechanics dynamism. Note they were all issued in less than one minute:</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
><TT
CLASS="prompt"
>bash$ </TT
><B
CLASS="command"
>ls -al /etc/localtime</B
>
lrwxrwxrwx  1 root root 35 May 22  2001 /etc/localtime -&#62; <EM
>/usr/share/zoneinfo/Brazil/Brasilia</EM
>
<TT
CLASS="prompt"
>bash$ </TT
><B
CLASS="command"
>date</B
>
Fri Mar 29 20:13:38 <EM
>BRST</EM
> 2002
<TT
CLASS="prompt"
>bash# </TT
><B
CLASS="command"
>ln -sf /usr/share/zoneinfo/GMT /etc/localtime</B
>
<TT
CLASS="prompt"
>bash$ </TT
><B
CLASS="command"
>date</B
>
Fri Mar 29 23:13:47 <EM
>GMT</EM
> 2002
<TT
CLASS="prompt"
>bash# </TT
><B
CLASS="command"
>ln -sf /usr/share/zoneinfo/Brazil/Brasilia /etc/localtime</B
>
<TT
CLASS="prompt"
>bash$ </TT
><B
CLASS="command"
>date</B
>
Fri Mar 29 20:14:03 <EM
>BRST</EM
> 2002</PRE
></FONT
></TD
></TR
></TABLE
><P
>At 20:13, I was in my default brazilian Time Zone (BRST), then I switched to GMT and my system time changed to 23:13! When your Time Zone enters DST, you'll see a similar effect, but the rules are all inside your Time Zone (<TT
CLASS="filename"
>/etc/localtime</TT
> link doesn't change like this example).</P
><P
>An application running in this machine (eg. web-server generating access logs) will feel this change, so it is very important for developers to remember that the full Time Concept is the current <EM
>time</EM
> plus current <EM
>Time Zone</EM
>, as described in <A
HREF="#time"
>Section 2</A
>.</P
><P
>In the end, I switched back to my correct Time Zone.</P
></DIV
></DIV
><DIV
CLASS="section"
><HR><H1
CLASS="section"
><A
NAME="set"
></A
>4. The Correct Settings for Your Linux Box</H1
><P
>For any OS installation, you must know your Time Zone. This is expressed in terms of a city, a state or a country. You must also decide how to set <SPAN
CLASS="acronym"
>BIOS</SPAN
> time, and we may follow two strategies here:</P
><P
></P
><DIV
CLASS="variablelist"
><DL
><DT
><EM
>Linux Only Machine</EM
></DT
><DD
><P
>In this case you should set <SPAN
CLASS="acronym"
>BIOS</SPAN
> time to <SPAN
CLASS="acronym"
>UTC</SPAN
> time. <SPAN
CLASS="acronym"
>DST</SPAN
> changes will be dynamically managed by <A
HREF="#tz.linux"
>Time Zone configurations</A
>.</P
></DD
><DT
><EM
>Dual Boot Linux and MS Windows Machine</EM
></DT
><DD
><P
>Windows handles time in a more primitive way than Linux. For Windows, <SPAN
CLASS="acronym"
>BIOS</SPAN
> time is allways your local time, so <SPAN
CLASS="acronym"
>DST</SPAN
> changes are more aggressive because they directly change hardware clock. And since both Linux and Windows initially get and set time from the hardware, when they are together, Linux must handle it in the same way. So set <SPAN
CLASS="acronym"
>BIOS</SPAN
> time to your localtime.</P
></DD
></DL
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="set.tz"
></A
>4.1. Setting Time Zone</H2
><P
>On Red Hat Linux and derived systems, you can set the hardware clock strategy and Time Zone using the <B
CLASS="command"
>timeconfig</B
> command, that shows a user-friendly dialog. You can also use it non-interactively:</P
><DIV
CLASS="example"
><A
NAME="AEN338"
></A
><P
><B
>Example 2. Time Configuration Tool</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
><TT
CLASS="prompt"
>bash# </TT
><B
CLASS="command"
>timeconfig "Brasil/East"</B
>   # set HC to localtime, and TZ to "Brazil/East"
<TT
CLASS="prompt"
>bash# </TT
><B
CLASS="command"
>timeconfig --utc "Brasil/East"</B
>   # set HC to UTC, and TZ to "Brazil/East"</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>Anyway, it changes <TT
CLASS="filename"
>/etc/sysconfig/clock</TT
> file that is read at boot time. You can edit it by hand, and that is how it looks:</P
><DIV
CLASS="example"
><A
NAME="AEN347"
></A
><P
><B
>Example 3. <TT
CLASS="filename"
>/etc/sysconfig/clock</TT
> file</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
>&#13;ZONE="Brazil/East"
UTC=true
ARC=false</PRE
></FONT
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="set.hwclock"
></A
>4.2. Setting the Hardware Clock</H2
><P
>I encourage you to set your hardware clock only after understanding how to get accurate time, described on <A
HREF="#ntp"
>Section 5</A
>.</P
><P
>The <B
CLASS="command"
>hwclock</B
> command reads and sets the hardware clock, based on several options you give to it, documented in its man page. But you don't have to use it if you have a modern Linux distribution. After defining your hardware clock strategy and Time Zone, you can use the high level <B
CLASS="command"
>setclock</B
> command to correctly set your hardware clock. You don't need to pass any parameters because <B
CLASS="command"
>setclock</B
> intelligently calls <B
CLASS="command"
>hwclock</B
> to set the <SPAN
CLASS="acronym"
>BIOS</SPAN
> based on your OS current date and time. <EM
>So you should always use the <B
CLASS="command"
>setclock</B
> command.</EM
></P
><P
>But if you are a minimalist and prefer hard work, here are some <B
CLASS="command"
>hwclock</B
> examples:</P
><DIV
CLASS="example"
><A
NAME="AEN365"
></A
><P
><B
>Example 4. <B
CLASS="command"
>setclock</B
> and <B
CLASS="command"
>hwclock</B
> usage</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
><TT
CLASS="prompt"
>bash# </TT
><B
CLASS="command"
>setclock</B
>					# The easy way to set HC
<TT
CLASS="prompt"
>bash# </TT
><B
CLASS="command"
>hwclock</B
>					# reads HC
<TT
CLASS="prompt"
>bash# </TT
><B
CLASS="command"
>hwclock --systohc --utc</B
>			# set HC with UTC time based on OS current time
<TT
CLASS="prompt"
>bash# </TT
><B
CLASS="command"
>hwclock --systohc</B
>				# set HC with local time based on OS current time
<TT
CLASS="prompt"
>bash# </TT
><B
CLASS="command"
>hwclock --set --date "21 Oct 2004 21:17"</B
>	# set HC with time specified on string</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>Since the OS time is independent from the hardware clock, any <SPAN
CLASS="acronym"
>BIOS</SPAN
> change we make will take place in the next boot.</P
><P
>Another option to change HC is rebooting and accessing your computer <SPAN
CLASS="acronym"
>BIOS</SPAN
> screens. On <A
HREF="http://ibm.com/servers/eserver/zseries/os/linux/"
TARGET="_top"
>IBM e-server zSeries</A
> platforms you'll have to do it on z/VM level, because Linux here runs on virtual machines created by z/VM.</P
></DIV
></DIV
><DIV
CLASS="section"
><HR><H1
CLASS="section"
><A
NAME="ntp"
></A
>5. Accurate Global Time Synchronization</H1
><P
>To have accurate time in all your systems is as important as having a solid network security strategy (achieved by much more than simple firewall boxes). It is one of the primary components of a system administration based on good practices, which leads to organization and security. Specially when administering distributed applications, web-services, or even a distributed security monitoring tool, accurate time is a must.</P
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="ntp.ntp"
></A
>5.1. <SPAN
CLASS="acronym"
>NTP</SPAN
>: The Network Time Protocol</H2
><P
>We won't discuss here the protocol, but how this wonderful invention, added to the pervasivenes of the Internet, can be useful for us. You can find more about it at <A
HREF="http://www.ntp.org/"
TARGET="_top"
>www.ntp.org</A
>.</P
><P
>Once your system is properly setup, <SPAN
CLASS="acronym"
>NTP</SPAN
> will manage to keep its time accurate, making very small adjustments to not impact the running applications.</P
><P
>People can get exact time using hardware based on atom's electrons frequency. There is also a method based on <SPAN
CLASS="acronym"
>GPS</SPAN
> (Global Positioning System). The first is more accurate, but the second is pretty good also. Atomic clocks require very special and expensive equipment, but their maintainers (usually universities and research labs) connect them to computers, that run an <SPAN
CLASS="acronym"
>NTP</SPAN
> daemon, and some of them are connected to the Internet, that finally let us access them for free. And this is how we'll synchronize our systems.</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="ntp.arch"
></A
>5.2. Building a Simple Time Synchronization Architecture</H2
><P
>You will need:</P
><P
></P
><OL
TYPE="1"
><LI
><P
>A direct or indirect (through a firewall) connection to the Internet.</P
></LI
><LI
><P
>Choose some <SPAN
CLASS="acronym"
>NTP</SPAN
> servers. You can use the public server <A
HREF="http://www.fortytwo.ch/time/"
TARGET="_top"
>pool.ntp.org</A
>, or choose some from the <A
HREF="http://www.eecis.udel.edu/~mills/ntp/clock2a.html"
TARGET="_top"
>stratum 2 public time servers</A
> on <SPAN
CLASS="acronym"
>NTP</SPAN
> website. If you don't have an Internet access, your <SPAN
CLASS="acronym"
>WAN</SPAN
> administrator (must be a clever guy) can provide you some internal addresses.</P
></LI
><LI
><P
>Have the <SPAN
CLASS="acronym"
>NTP</SPAN
> package installed in all systems you want to synchronize. You can find RPMs in your favorite Linux distribution CD, or <A
HREF="http://rpmfind.net/linux/rpm2html/search.php?query=ntp"
TARGET="_top"
>make a search</A
> on <A
HREF="http://rpmfind.net/"
TARGET="_top"
>rpmfind.net</A
>.</P
></LI
></OL
><P
>Here is an example of good architecture:</P
><DIV
CLASS="figure"
><A
NAME="AEN417"
></A
><P
><B
>Figure 1. Local Relay Servers for NTP</B
></P
><P
><IMG
SRC="ntp.png"
ALIGN="center"></P
></DIV
><P
>If you have several machines to synchronize, <EM
>do not</EM
> make them all access the remote <SPAN
CLASS="acronym"
>NTP</SPAN
> servers you chose. Only 2 of your server farm's machines must access remote <SPAN
CLASS="acronym"
>NTP</SPAN
> servers, and the other machines will sync with these 2. We will call them the <EM
>Relay Servers</EM
>.</P
><P
>Your Relay Servers can be any machine already available in your network. <SPAN
CLASS="acronym"
>NTP</SPAN
> consumes low memory and CPU. You don't need a dedicated machine for it.</P
><DIV
CLASS="tip"
><P
></P
><TABLE
CLASS="tip"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/tip.gif"
HSPACE="5"
ALT="Tip"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>It is a good idea to create hostname aliases for your local Relay Servers like ntp1.my.com and ntp2.my.com, and use only these names when configuring the client machines. This way you can move the <SPAN
CLASS="acronym"
>NTP</SPAN
> functionality to a new Relay Server (with a different IP and hostname), without having to reconfigure the clients. Ask your <SPAN
CLASS="acronym"
>DNS</SPAN
> administrator to create such aliases.</P
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="ntp.configs"
></A
>5.3. <SPAN
CLASS="acronym"
>NTP</SPAN
> Configurations</H2
><P
></P
><DIV
CLASS="variablelist"
><DL
><DT
><EM
>For Your Relay Servers</EM
></DT
><DD
><P
>Edit <TT
CLASS="filename"
>/etc/ntp.conf</TT
> and add the remote servers you chose:</P
><DIV
CLASS="example"
><A
NAME="AEN441"
></A
><P
><B
>Example 5. Relay machines' <TT
CLASS="filename"
>/etc/ntp.conf</TT
></B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
>&#13;.
.
server  otherntp.server.org	# A stratum 1 server at server.org
server  ntp.research.gov	# A stratum 2 server at research.gov
.
.</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
>Again, you can use the public server <A
HREF="http://www.fortytwo.ch/time/"
TARGET="_top"
>pool.ntp.org</A
>, or get a list of <A
HREF="http://www.eecis.udel.edu/~mills/ntp/clock2a.html"
TARGET="_top"
>public stratum 2 time servers</A
> from <SPAN
CLASS="acronym"
>NTP</SPAN
> website.</P
></DD
><DT
><EM
>For Your Clients</EM
></DT
><DD
><P
>Edit <TT
CLASS="filename"
>/etc/ntp.conf</TT
> and add your Relay Servers with a standard name:</P
><DIV
CLASS="example"
><A
NAME="AEN455"
></A
><P
><B
>Example 6. Client machines' <TT
CLASS="filename"
>/etc/ntp.conf</TT
></B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
>&#13;.
.
server  ntp1.my.com		# My first local relay
server  ntp2.my.com		# My second local relay
.
.</PRE
></FONT
></TD
></TR
></TABLE
></DIV
></DD
></DL
></DIV
><P
>If your machine has a UTC time difference bigger than some minutes comparing to the <SPAN
CLASS="acronym"
>NTP</SPAN
> servers, <SPAN
CLASS="acronym"
>NTP</SPAN
> will not work. So you must do a first full sync, and I recommend you to do it in a non-production hour. You need to do it only when you are making the initial <SPAN
CLASS="acronym"
>NTP</SPAN
> setup. Never more:</P
><DIV
CLASS="example"
><A
NAME="AEN463"
></A
><P
><B
>Example 7. First sync</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
><TT
CLASS="prompt"
>bash# </TT
><B
CLASS="command"
>ntpdate otherntp.research.gov</B
>	<A
NAME="sync1"
><IMG
SRC="../images/callouts/1.gif"
HSPACE="0"
VSPACE="0"
BORDER="0"
ALT="(1)"></A
>
24 Mar 18:16:36 ntpdate[10254]: step time server 200.100.20.10 offset -15.266188 sec
<TT
CLASS="prompt"
>bash# </TT
><B
CLASS="command"
>ntpdate otherntp.research.gov</B
>	<A
NAME="sync2"
><IMG
SRC="../images/callouts/2.gif"
HSPACE="0"
VSPACE="0"
BORDER="0"
ALT="(2)"></A
>
24 Mar 18:16:43 ntpdate[10255]: adjust time server 200.100.20.10 offset -0.000267 sec</PRE
></FONT
></TD
></TR
></TABLE
><DIV
CLASS="calloutlist"
><DL
COMPACT="COMPACT"
><DT
><A
HREF="#sync1"
><IMG
SRC="../images/callouts/1.gif"
HSPACE="0"
VSPACE="0"
BORDER="0"
ALT="(1)"></A
></DT
><DD
>First full sync. We were 15 seconds late.</DD
><DT
><A
HREF="#sync2"
><IMG
SRC="../images/callouts/2.gif"
HSPACE="0"
VSPACE="0"
BORDER="0"
ALT="(2)"></A
></DT
><DD
>Second full sync, just to be sure. Now we are virtually 0 seconds late, which is good.</DD
></DL
></DIV
></DIV
><P
>The last step is to start or restart the <SPAN
CLASS="acronym"
>NTP</SPAN
> daemons in each machine:</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;<TT
CLASS="prompt"
>bash# </TT
><B
CLASS="command"
>service ntpd restart</B
>
			</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="ntp.watch"
></A
>5.4. Watching Your Box Synchronizing</H2
><P
>Now you have everything setup. <SPAN
CLASS="acronym"
>NTP</SPAN
> will softly keep your machine time synchronized. You can watch this process using the NTP Query (<B
CLASS="command"
>ntpq</B
> command):</P
><DIV
CLASS="example"
><A
NAME="AEN487"
></A
><P
><B
>Example 8. A time synchronization status</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
><TT
CLASS="prompt"
>bash# </TT
><B
CLASS="command"
>ntpq -p</B
>
     remote           refid      st t when poll reach   delay   offset  jitter
==============================================================================
-jj.cs.umb.edu   gandalf.sigmaso  3 u   95 1024  377   31.681  -18.549   1.572
 milo.mcs.anl.go ntp0.mcs.anl.go  2 u  818 1024  125   41.993  -15.264   1.392
-mailer1.psc.edu ntp1.usno.navy.  2 u  972 1024  377   38.206   19.589  28.028
-dr-zaius.cs.wis ben.cs.wisc.edu  2 u  502 1024  357   55.098    3.979   0.333
+taylor.cs.wisc. ben.cs.wisc.edu  2 u  454 1024  347   54.127    3.379   0.047
-ntp0.cis.strath harris.cc.strat  3 u  507 1024  377  115.274   -5.025   1.642
*clock.via.net   .GPS.            1 u  426 1024  377  107.424   -3.018   2.534
 ntp1.conectiv.c 0.0.0.0         16 u    - 1024    0    0.000    0.000 4000.00
+bonehed.lcs.mit .GPS.            1 u  984 1024  377   25.126    0.131  30.939
-world.std.com   204.34.198.40    2 u  119 1024  377   24.229   -6.884   0.421</PRE
></FONT
></TD
></TR
></TABLE
></DIV
><P
></P
><DIV
CLASS="variablelist"
><P
><B
>The meaning of each column</B
></P
><DL
><DT
><EM
>remote</EM
></DT
><DD
><P
>Is the name of the remote <SPAN
CLASS="acronym"
>NTP</SPAN
> server. If you use the <TT
CLASS="option"
>-n</TT
> switch, you will see the IP addresses of these servers instead of their hostnames.</P
></DD
><DT
><EM
>refid</EM
></DT
><DD
><P
>Indicates where each server is getting its time right now. It can be a server hostname or something like <SPAN
CLASS="acronym"
>.GPS.</SPAN
>, indicating a Global Positioning System source.</P
></DD
><DT
><EM
>st</EM
></DT
><DD
><P
><EM
>Stratum</EM
> is a number from 1 to 16, to indicate the remote server precision. 1 is the most accurate, 16 means 'server unreachable'. Your Stratum will be equal to the accurate remote server plus 1. Never connect to a Stratum 1 server, use Stratum 2 servers! Stratum 2 servers are also good for our purposes, and this policy is good for reducing the traffic to the Stratum 1 servers.</P
></DD
><DT
><EM
>poll</EM
></DT
><DD
><P
>The polling interval (in seconds) between time requests. The value will range between the minimum and maximum allowed polling values. Initially the value will be smaller to allow synchronization to occur quickly. After the clocks are 'in sync' the polling value will increase to reduce network traffic and load on popular time servers.</P
></DD
><DT
><EM
>reach</EM
></DT
><DD
><P
>This is an octal representation of an array of 8 bits, representing the last 8 times the local machine tried to reach the server. The bit is set if the remote server was reached.</P
></DD
><DT
><EM
>delay</EM
></DT
><DD
><P
>The amount of time (seconds) needed to receive a response for a "what time is it" request.</P
></DD
><DT
><EM
>offset</EM
></DT
><DD
><P
>The most important value. The difference of time between the local and remote server. In the course of synchronization, the offset time lowers down, indicating that the local machine time is getting more accurate.</P
></DD
><DT
><EM
>jitter</EM
></DT
><DD
><P
>Dispersion, also called Jitter, is a measure of the statistical variance of the offset across several successive request/response pairs. Lower dispersion values are preferred over higher dispersion values. Lower dispersions allow more accurate time synchronization.</P
></DD
></DL
></DIV
><P
></P
><DIV
CLASS="variablelist"
><P
><B
>The meaning of the signs before server hostname</B
></P
><DL
><DT
><EM
>-</EM
></DT
><DD
><P
>Means the local NTP service doesn't like this server very much</P
></DD
><DT
><EM
>+</EM
></DT
><DD
><P
>Means the local NTP service likes this server</P
></DD
><DT
><EM
>x</EM
></DT
><DD
><P
>Marks a bad host</P
></DD
><DT
><EM
>*</EM
></DT
><DD
><P
>Indicates the current favorite</P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="ntp.boot"
></A
>5.5. Configure to Automatically Run <SPAN
CLASS="acronym"
>NTP</SPAN
> at Boot</H2
><P
>You may want to have <SPAN
CLASS="acronym"
>NTP</SPAN
> running all the time even if you reboot your machine. On each machine, do the following:</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>&#13;<TT
CLASS="prompt"
>bash# </TT
><B
CLASS="command"
>chkconfig --level 2345 ntpd on</B
>
			</PRE
></FONT
></TD
></TR
></TABLE
><P
>This will ensure autostart.</P
><P
>If your machine is up and running for a long time (months, years) without rebooting, you'll find a big discrepancy between the inaccurate hardware clock and the (now very accurate) system time. Modern Linux distributions copy OS time to the HC everytime the system is shutdown, using a <A
HREF="#set.hwclock"
>mechanism similar to the <B
CLASS="command"
>setclock</B
> command</A
>. This way, in the next OS boot, you'll get date and time almost as accurate as it was when you shutdown the machine.</P
></DIV
></DIV
><DIV
CLASS="section"
><HR><H1
CLASS="section"
><A
NAME="ntp.chrony"
></A
>6. Precise Time with the <B
CLASS="command"
>chrony</B
> Program</H1
><DIV
CLASS="section"
><H2
CLASS="section"
><A
NAME="ntp.chrony.diff"
></A
>6.1. How <B
CLASS="command"
>chrony</B
> Differs from the <B
CLASS="command"
>ntp</B
> Suite?</H2
><P
><B
CLASS="command"
>chrony</B
> also uses the <SPAN
CLASS="acronym"
>NTP</SPAN
> protocol, and is also designed to make Linux clock more accurate. It is also suitable for systems that do not have an Internet connection. Then the source of the exact time can be any accurate clock, from which we can read the time and type it to the program. In addition, it is also capable of calculating the inaccuracy of the hardware clock, and based on that, adjust the hardware clock at boot time.</P
><P
><B
CLASS="command"
>chrony</B
> 1.20 does not support built-in hardware clocks like GPS and DCF receivers, but the structure of the program makes such development possible.</P
></DIV
><DIV
CLASS="section"
><HR><H2
CLASS="section"
><A
NAME="ntp.chrony.how"
></A
>6.2. How to Use <B
CLASS="command"
>chrony</B
>?</H2
><P
><B
CLASS="command"
>chrony</B
> consists of two parts: <B
CLASS="command"
>chronyd</B
> daemon and a user interface <B
CLASS="command"
>chronyc</B
>.</P
><P
>You can find <B
CLASS="command"
>chrony</B
> at <A
HREF="http://chrony.sunsite.dk/index.php/"
TARGET="_top"
>chrony.sunsite.dk/index.php</A
></P
></DIV
></DIV
><DIV
CLASS="appendix"
><HR><H1
CLASS="appendix"
><A
NAME="about"
></A
>A. About this Document</H1
><P
>Copyright 2002, Avi Alkalay.</P
><P
>This document must be distributed under the terms of <A
HREF="http://www.gnu.org/copyleft/fdl.html"
TARGET="_top"
>GNU Free Documentation License</A
>. Please translate, adapt, improve, redistribute using the original XML DocBook source right bellow. Let me know if you want me to put a link to your translation/adaptation/improvement here.</P
><P
>This document is published in the following locations:
			<P
></P
><UL
><LI
><P
><A
HREF="http://avi.alkalay.net/linux/docs/TimePrecision/"
TARGET="_top"
>Official site</A
> [<A
HREF="http://avi.alkalay.net/linux/docs/TimePrecision/timeprecision-20051118.tar.gz"
TARGET="_top"
>XML (DocBook) Source</A
>]</P
></LI
><LI
><P
><A
HREF="http://en.tldp.org/HOWTO/TimePrecision-HOWTO/"
TARGET="_top"
>TLDP, as a HOWTO</A
> [<A
HREF="http://www.ibiblio.org/pub/Linux/docs/HOWTO/other-formats/html_single/TimePrecision-HOWTO.html"
TARGET="_top"
>single page</A
>] [<A
HREF="http://www.ibiblio.org/pub/Linux/docs/HOWTO/other-formats/pdf/TimePrecision-HOWTO.pdf"
TARGET="_top"
>PDF</A
>]</P
></LI
><LI
><P
>Philippe Wautelet &#60;p.wautelet fractalzone.be&#62; <A
HREF="http://www.traduc.org/docs/HOWTO/lecture/TimePrecision-HOWTO.html"
TARGET="_top"
>french translation</A
> [<A
HREF="http://www.traduc.org/cgi-bin/viewcvs.cgi/guides_pratiques/TimePrecision-HOWTO.xml"
TARGET="_top"
>XML (DocBook) Source</A
>]</P
></LI
><LI
><P
>Takeo Nakano &#60;nakano at apm.seikei.ac.jp&#62; <A
HREF="http://www.linux.or.jp/JF/JFdocs/TimePrecision-HOWTO/"
TARGET="_top"
>japanese translation</A
> [<A
HREF="http://www.linux.or.jp/JF/JFdocs/TimePrecision-HOWTO.txt"
TARGET="_top"
>txt version</A
>]</P
></LI
><LI
><P
>SHAKI &#60;sha-ki at narod.ru&#62; <A
HREF="http://computerlib.narod.ru/html/linuxtime.htm"
TARGET="_top"
>russian translation</A
></P
></LI
><LI
><P
>Mihaly Gyulai &#60;gyulai kukac fbi pont hu&#62; <A
HREF="http://tldp.fsf.hu/HOWTO/TimePrecision-HOWTO-hu/index.html"
TARGET="_top"
>Hungarian translation - magyar forditas</A
></P
></LI
><LI
><P
>Kemal √ñkmen &#60;kemal AT comu edu tr&#62; <A
HREF="http://www.belgeler.org/howto/time-precision-howto.html"
TARGET="_top"
>Turkish translation - T√ºrk√ße √ßeviri</A
></P
></LI
></UL
>
		</P
><P
>When translating, feel free to change all brazilian-related configuration examples to your country's. And please send me an e-mail containing the translator's name, e-mail address, the language that this doc was translated to, the phrase "[YOUR LANGUAGE] translation" in your language, all UTF-8 encoded. This way I can put, in the original document, in your language, a link to your translation. Also, please let the <A
HREF="http://tldp.org"
TARGET="_top"
>TLDP</A
> folks be aware of your translation, so they can add it to the collection of HOWTOs in your language.</P
></DIV
></DIV
></BODY
></HTML
>